<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>pwr4exp: Power Analysis for Experimental Designs</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">pwr4exp: Power Analysis for Experimental
Designs</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(pwr4exp)</span></code></pre></div>
<div id="foundational-concepts" class="section level1">
<h1>Foundational Concepts</h1>
<p>The <strong>pwr4exp</strong> R package offers functionality for power
analysis. The package is developed based on linear mixed model (LMM)
theory, offering tailored functions for standard experimental designs in
animal science and beyond. The current version does not yet support
non-normal response variables, such as those encountered in generalized
LMM.</p>
<p>Linear mixed model is a powerful tool for analyzing data from various
experimental designs, especially when accounting for both fixed and
random effects. The general form of an LMM can be expressed as:</p>
<p><span class="math display">\[
y = X\beta + Zu + \varepsilon
\]</span></p>
<p>where: <span class="math inline">\(y\)</span> represents the
observations of the response variable, <span class="math inline">\(\beta\)</span> represents the fixed effect
coefficients, <span class="math inline">\(u\)</span> denotes the random
effects, where <span class="math inline">\(u \sim N_q(0, G)\)</span>,
<span class="math inline">\(\varepsilon\)</span> represents the random
errors, where <span class="math inline">\(\varepsilon \sim N_n(0,
R)\)</span>, <span class="math inline">\(X_{(n \times p)}\)</span> and
<span class="math inline">\(Z_{(n \times q)}\)</span> are the design
matrices for the fixed and random effects, respectively.</p>
<p>It is assumed that <span class="math inline">\(u\)</span> and <span class="math inline">\(\varepsilon\)</span> are independent, and the
marginal distribution of <span class="math inline">\(y\)</span> follows
a normal distribution <span class="math inline">\(y \sim N_n(X\beta,
V)\)</span>, where:</p>
<p><span class="math display">\[
V = ZGZ^T + R
\]</span></p>
<div id="inference-on-treatment-effects" class="section level2">
<h2>Inference on Treatment Effects</h2>
<p>Inference on treatment effects often involves testing omnibus
hypotheses and contrasts. These can be formulated using the general
linear hypothesis:</p>
<p><span class="math display">\[
H_0: K&#39;\beta = 0
\]</span></p>
<p>where <span class="math inline">\(K&#39;\)</span> is a contrast
matrix. When the variance-covariance parameters in <span class="math inline">\(G\)</span> and <span class="math inline">\(R\)</span> are known, the estimate of <span class="math inline">\(\beta\)</span> is:</p>
<p><span class="math display">\[
\hat{\beta} = (X^TV^{-1}X)^{-1}X^TV^{-1}y
\]</span></p>
<p>And its variance is:</p>
<p><span class="math display">\[
C = (X^TV^{-1}X)^{-1}
\]</span></p>
<p>The sampling distribution of <span class="math inline">\(K&#39;\hat{\beta}\)</span> is:</p>
<p><span class="math display">\[
K&#39;\hat{\beta} \sim N(0, K&#39;CK)
\]</span></p>
<p>However, in practical situations, the matrices <span class="math inline">\(G\)</span> and <span class="math inline">\(R\)</span> are unknown and must be estimated using
methods like Maximum Likelihood (ML) or Restricted ML (REML). The
estimate of <span class="math inline">\(\beta\)</span> is obtained by
plugging in the estimated covariance matrices <span class="math inline">\(\hat{V}\)</span>, where:</p>
<p><span class="math display">\[
\hat{V} = Z\hat{G}Z^T + \hat{R}
\]</span></p>
<p>The resulting estimate of <span class="math inline">\(\beta\)</span>
is:</p>
<p><span class="math display">\[
\hat{\beta} = (X^T\hat{V}^{-1}X)^{-1}X^T\hat{V}^{-1}y
\]</span></p>
<p>And its estimated variance is:</p>
<p><span class="math display">\[
\hat{C} = (X^T\hat{V}^{-1}X)^{-1}
\]</span></p>
<p>When testing the null hypothesis <span class="math inline">\(H_0:
K&#39;\beta = 0\)</span>, an approximate F-statistic is used. The
F-statistic is given by:</p>
<p><span class="math display">\[
F = \frac{(K&#39;\hat{\beta})&#39; [K&#39;\hat{C}K&#39;]^{-1}
(K&#39;\hat{\beta})}{\text{rank}(K)}
\]</span></p>
<p><span class="math inline">\(F\)</span> follows an approximate
F-distribution <span class="math inline">\(F(v_1, v_2)\)</span> under
<span class="math inline">\(H_0\)</span>, where <span class="math inline">\(v_1 = \text{rank}(K) \geq 1\)</span> represents
the numerator degrees of freedom (df), <span class="math inline">\(v_2\)</span> is the denominator df.</p>
<p>When <span class="math inline">\(\text{rank}(K) = 1\)</span>, the
F-statistic simplifies to the square of the t-statistic:</p>
<p><span class="math display">\[
F = t^2
\]</span>where <span class="math inline">\(t =
\frac{K&#39;\hat{\beta}}{\sqrt{K&#39;\hat{C}K}}\)</span> with <span class="math inline">\(v_2\)</span> df.</p>
<p>In balanced designs, where data is analyzed using a variance
components model—commonly applied in experimental animal research—<span class="math inline">\(v_2\)</span>​ can be precisely determined through
degrees of freedom decomposition, as applied in analysis of variance
(ANOVA):</p>
<p><span class="math display">\[
v_2 = n - 1 - [\text{rank}(X) - 1] - [\text{rank}(Z) - 1]
\]</span></p>
<p>However, for general cases, such as unbalanced designs or models with
correlated random intercept and slope effects, <span class="math inline">\(v_2\)</span> must be approximated using methods
like Satterthwaite’s approximation (Fai and Cornelius, 1996) or
Kenward-Roger’s method (Kenward and Roger, 1997), as implemented in the
<strong>lmerTest</strong> package.</p>
</div>
<div id="power-calculation-under-the-alternative-hypothesis" class="section level2">
<h2>Power Calculation Under the Alternative Hypothesis</h2>
<p>Under the alternative hypothesis <span class="math inline">\(H_A:
K&#39;\beta \neq 0\)</span>, the F-statistic follows a non-central
distribution <span class="math inline">\(F(v_1, v_2, \phi)\)</span>,
where <span class="math inline">\(\phi\)</span> is the non-centrality
parameter that measures the departure from the null hypothesis <span class="math inline">\(H_0\)</span>. The non-centrality parameter <span class="math inline">\(\phi\)</span> is given by:</p>
<p><span class="math display">\[
\phi = (K&#39;\hat{\beta})&#39; [K&#39;\hat{C}K&#39;]^{-1}
(K&#39;\hat{\beta})
\]</span></p>
<p>Once the distribution of the F-statistic under <span class="math inline">\(H_A\)</span> is known, the power of the test can
be calculated as the conditional probability of rejecting <span class="math inline">\(H_0\)</span> when <span class="math inline">\(H_A\)</span> is true:</p>
<p><span class="math display">\[
\text{Power} = P(\text{reject } H_0: F &gt; F_{\text{crit}} \mid H_A)
\]</span></p>
<p>Where: <span class="math inline">\(F_{\text{crit}}\)</span> is the
critical value of the F-statistic used to reject <span class="math inline">\(H_0\)</span>, determined such that <span class="math inline">\(P(F &gt; F_{\text{crit}} \mid H_0) =
\alpha\)</span>, where <span class="math inline">\(\alpha\)</span> is
the type I error rate.</p>
<p>The determination of the degrees of freedom <span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span>, as well as the non-centrality
parameter <span class="math inline">\(\phi\)</span>, are critical steps
for power calculation. Notably, <span class="math inline">\(\phi\)</span> resembles the numerator of the
F-statistic but with population parameters for <span class="math inline">\(\beta\)</span>, <span class="math inline">\(G\)</span>, and <span class="math inline">\(R\)</span> replacing their sample estimates <span class="math inline">\(\hat{\beta}\)</span>, <span class="math inline">\(\hat{G}\)</span>, and <span class="math inline">\(\hat{R}\)</span>.</p>
<p>Generally, power analysis requires specifying the following
components:</p>
<ul>
<li>The <strong>Design</strong> to be evaluated, which determines the
matrices <span class="math inline">\(X\)</span> (fixed effects) and
<span class="math inline">\(Z\)</span> (random effects).</li>
<li>The <strong>Treatment Effects</strong>, which determine <span class="math inline">\(\beta\)</span> (the fixed effect
coefficients).</li>
<li>The <strong>Variance Components</strong>, which determine <span class="math inline">\(G\)</span> (the covariance matrix of the random
effects) and <span class="math inline">\(R\)</span> (the covariance
matrix of the residuals).</li>
</ul>
<p>A key aspect of conducting a valid power analysis is obtaining
<strong>reasonable estimates for the magnitude of the
parameters</strong> that will be used in the model. This includes:</p>
<ul>
<li><strong>Treatment Effects</strong> (<span class="math inline">\(\beta\)</span>): The size of the treatment
effect(s) you expect to detect. This can be obtained from previous
studies, pilot experiments, or subject-matter expertise.</li>
<li><strong>Variance Components</strong> (<span class="math inline">\(G\)</span> and <span class="math inline">\(R\)</span>): These represent the variability in
the random effects and residual errors. Variance estimates are often
obtained from:
<ul>
<li><strong>Pilot studies</strong> or preliminary data, which can
provide initial estimates of variability in random effects (e.g.,
subject-to-subject variability or group-level variability).</li>
<li><strong>Literature</strong> on similar experiments, where variance
components have been reported.</li>
<li><strong>Subject-matter expertise</strong>, where researchers provide
estimates based on their knowledge of the system being studied.</li>
</ul></li>
</ul>
<p>Performing a power analysis with unrealistic parameter magnitudes can
lead to incorrect conclusions, either overestimating the likelihood of
detecting a treatment effect or requiring an unnecessarily large sample
size.</p>
</div>
</div>
<div id="getting-started" class="section level1">
<h1>Getting Started</h1>
<p>This section provides an overview of the package’s functionality. The
<strong>pwr4exp</strong> package is designed to streamline statistical
power calculations into a simple, user-friendly pipeline. Performing a
power analysis in <strong>pwr4exp</strong> involves two steps: creating
a design object and then calculating power or determining sample
size.</p>
<div id="step1-creating-a-design-object" class="section level2">
<h2>Step1: Creating a Design Object</h2>
<p>Design objects in <strong>pwr4exp</strong> can be created using
functions that generate several standard experimental designs available
in the package. These functions include:</p>
<ul>
<li><code>designCRD(treatments, label, replicates, formula, beta, sigma2)</code>:
For completely randomized design (CRD).</li>
<li><code>designRCBD(treatments, label, blocks, formula, beta, VarCov, sigma2, ...)</code>:
For randomized complete block design (RCBD).</li>
<li><code>designLSD(treatments, label, squares, reuse, formula, beta, VarCov, sigma2, ...)</code>:
For Latin square design (LSD).</li>
<li><code>designCOD(treatments, label, squares, formula, beta, VarCov, sigma2, ...)</code>:
For crossover design (COD), which is a special case of LSD with time
periods and individuals as blocks. Period blocks are reused when
replicating squares.</li>
<li><code>designSPD(trt.main, trt.sub, label, replicates, formula, beta, VarCov, sigma2, ...)</code>:
For split-plot design (SPD).</li>
</ul>
<div id="arguments" class="section level3">
<h3>Arguments</h3>
<p>The arguments of these functions fall into the following main
categories:</p>
<div id="treatment-structure" class="section level4">
<h4><strong>Treatment structure</strong></h4>
<p>The arguments <code>treatments</code>, <code>trt.main</code>, and
<code>trt.sub</code> are used to specify the treatment structure. For
designs other than SPD, <code>treatments</code> defines the structure,
whereas in SPD, <code>trt.main</code> and <code>trt.sub</code> refer to
the main plot and subplot levels, respectively. The treatment structure
is specified by an integer-valued vector, where the length of the vector
represents the number of treatment factors, and each value indicates the
number of levels for each factor. A maximum of two factors is allowed
(for SPD, this applies to both the main plot and subplot levels),
arranged in a factorial design.</p>
<p>For instance, <code>treatments = 2</code> defines an experiment
involving two treatments (e.g., control vs. intervention). For two
factors, <code>treatments = c(2, 2)</code> sets up a “2x2” factorial
design to study main effects and interactions. In the case of SPD,
<code>trt.main = 2</code> specifies two levels of the main plot factor,
while <code>trt.sub = c(2, 2)</code> defines a “2x2” factorial design at
the subplot level.</p>
</div>
<div id="label" class="section level4">
<h4><strong>Label</strong></h4>
<p>The optional <code>label</code> argument is a list of character
vectors that specifies the names of treatment factors and their
corresponding levels. Each vector in the list represents a treatment
factor, where the name of the vector defines the name of the factor, and
the values in the vector are the labels for the levels of that
factor.</p>
<p>If the <code>label</code> argument is not provided, default names are
assigned to the factors and levels. For one treatment factor, the
default is <code>list(trt = c(&quot;1&quot;, &quot;2&quot;, ...))</code>. For two factors,
the default is
<code>list(facA = c(&quot;1&quot;, &quot;2&quot;, ...), facB = c(&quot;1&quot;, &quot;2&quot;, ...))</code>,
where “facA” and “facB” represent the two factors, and “1”, “2”, etc.,
represent the levels of each factor.</p>
<p>For example, <code>list(trt = c(&quot;ad libitum&quot;, &quot;fasting&quot;))</code>
customizes the levels of a single treatment factor to “ad libitum” and
“fasting.” For multiple factors,
<code>list(feed = c(&quot;ad libitum&quot;, &quot;fasting&quot;), dosage = c(&quot;D0&quot;, &quot;D1&quot;, &quot;D2&quot;))</code>
names the first factor “feed” with levels “ad libitum” and “fasting,”
and the second factor “dosage” with levels “D0,” “D1,” and “D2.”</p>
</div>
<div id="replication" class="section level4">
<h4><strong>Replication</strong></h4>
<p>Given the distinct randomization and replication mechanisms across
designs, the arguments <code>replicates</code>, <code>blocks</code>, and
<code>squares</code> are used to represent replication and to indicate
the sample size for different designs:</p>
<ul>
<li>The argument <code>replicates</code> specifies the number of
experimental units per treatment in a CRD or the number of main plots
(i.e., the number of experimental units per treatment at the main plot
level) in a SPD.</li>
<li><code>blocks</code> specifies the number of blocks in a RCBD.</li>
<li><code>squares</code> specifies the number of squares in a replicated
LSD or COD.</li>
</ul>
<p>In a CRD, setting <code>replicates = 10</code> and
<code>treatments = 4</code> (or <code>treatments = c(2, 2)</code>) means
that each treatment group consists of 10 experimental units, resulting
in a total of 40 experimental units. When configuring an SPD,
<code>replicates = 10</code> with <code>trt.main = 4</code> (or
<code>trt.main = c(2, 2)</code>) signifies that each main plot treatment
is replicated across 10 experimental units, totaling 40 main plots. For
an RCBD, using <code>blocks = 10</code> along with
<code>treatments = 4</code> (or <code>treatments = c(2, 2)</code>)
ensures that all four treatments are replicated across 10 different
blocks, leading to a total of 40 experimental units. In an LSD, setting
<code>squares = 3</code> with <code>treatments = 4</code> (or
<code>treatments = c(2, 2)</code>) implies the replication of a single
“4×4” square layout 3 times, resulting in a total of 48 experimental
units.</p>
</div>
<div id="model" class="section level4">
<h4><strong>Model</strong></h4>
<p>The <code>formula</code> argument specifies the model formula that
will be used to test effects during post-experimental data analysis.
This formula follows the same syntax used in R’s <code>lm</code>
function (for linear models) and <code>lmer</code> function (for linear
mixed models) to specify fixed and random effects. Each
design-generating function within the package comes with a default model
formula. The default formula incorporates interaction terms when two
treatment factors are present and fits blocking factors as random
effects where applicable. You can inspect the default formula from the
generated design object using <code>design$formula</code>, or by
checking the function’s documentation (<code>?function</code>).</p>
<p>For example, in a SPD with one treatment factor at the main plot
level and two factors at the subplot level, the default model formula
would be:
<code>y ~ trt.main * facA.sub * facB.sub + (1 | mainplot)</code>. This
formula tests all interactions, including three-way interactions. If no
interaction between the main plot and subplot factors is assumed, the
model formula can specify the model as :
<code>y ~ trt.main + facA.sub * facB.sub + (1 | mainplot)</code> by the
user.</p>
<p>Notably, when specifying the model formula manually, the names of the
treatment factors must be consistent with those provided in the
<code>label</code> argument.</p>
</div>
<div id="effect-size" class="section level4">
<h4><strong>Effect Size</strong></h4>
<p>The <code>beta</code> argument is a numeric vector of expected model
coefficients, representing the effect sizes. The first element
corresponds to the intercept term, which represents the mean of the
reference level for categorical variables. Subsequent elements
correspond to the effect sizes of the independent variables in the order
they appear in the model matrix. For categorical variables, each
coefficient represents the difference between a non-reference level and
the reference level (intercept), as the <code>contr.treatment</code>
contrast coding is used to construct the model matrix. It is important
to ensure that the <code>beta</code> vector aligns with the columns of
the model matrix, including any dummy variables created for categorical
predictors.</p>
<p>These values can either be specified directly or transformed from
group means. For example, consider a factor with 2 levels
(<code>treatments = 2</code>), representing control vs. intervention
(<code>label = list(trt = c(&quot;control&quot;, &quot;intervention&quot;))</code>). If
<code>beta = c(10, 5)</code>, this indicates that the mean of the
control group is 10, and the effect of the intervention is 5 units
higher than the control.</p>
<p>In another example, consider a “2 × 2” factorial arrangement
(<code>treatments = c(2, 2)</code> &amp;
<code>label= list(A = c(&quot;A1&quot;, &quot;A2&quot;), B = c(&quot;B1&quot;, &quot;B2&quot;))</code>):</p>
<p><span class="math display">\[
\begin{array}{c|c|c}
  &amp; B1 &amp; B2 \\
\hline
A1 &amp; 10 &amp; 6 \\
A2 &amp; 8  &amp; 12 \\
\end{array}
\]</span></p>
<p>The <code>beta</code> argument is specified as
<code>beta = c(10, -2, -4, 8)</code>, which represents the following
effects:</p>
<ul>
<li><p>The mean of the reference level (<code>A1B1</code>) is
10.</p></li>
<li><p>The effect of <code>A2</code> alone is -2 (i.e.,
<code>A2B1 - A1B1</code>).</p></li>
<li><p>The effect of <code>B2</code> alone is -4 (i.e.,
<code>A1B2 - A1B1</code>).</p></li>
<li><p>The interaction between <code>A2</code> and <code>B2</code> is 8,
representing the additional effect of combining <code>A2</code> and
<code>B2</code> compared to what would be expected from the sum of their
individual effects (<code>A2B2 - A2B1 - A1B2 + A1B1</code>).</p></li>
</ul>
</div>
<div id="variance-covariance" class="section level4">
<h4><strong>Variance-Covariance</strong></h4>
<p>The <code>VarCov</code> argument specifies the variance-covariance
components of random effects. If multiple terms exist for a single
random effect group, the variance-covariance matrix should be provided.
For example, the covariance matrix for random intercepts and random
slopes for a single grouping factor is structured as:</p>
<p><span class="math display">\[
\begin{pmatrix}
\tau_0^2 &amp; \tau_{12} \\
\tau_{12} &amp; \tau_1^2
\end{pmatrix}
\]</span></p>
<p>where <span class="math inline">\(\tau_0^2\)</span> represents the
variance of the random intercept, <span class="math inline">\(\tau_1^2\)</span> represents the variance of the
random slope, and <span class="math inline">\(\tau_{12}\)</span> is the
covariance between them.</p>
<p>For multiple random effect groups, supply the variance (for a single
random effect term) or the variance-covariance matrix (for two or more
random effect terms) of each group in a list, following the order
specified in the model formula.</p>
<p>In the standard designs available in <strong>pwr4exp</strong>, the
corresponding LMMs are typically variance component models, i.e., models
without random slopes. For example, in an RCBD with block as a random
effect, the required input is the variance between blocks:
<code>VarCov = \tau_b^2</code>. If there are multiple random effects,
for example, in an LSD with both row and column blocks as random
effects, the required input would be
<code>VarCov = list(\tau_r^2, \tau_c^2)</code>, representing the
variances of the row and column blocks, respectively.</p>
</div>
<div id="error-variance" class="section level4">
<h4><strong>Error Variance</strong></h4>
<p>The <code>sigma2</code> argument represents the variance of the
random error in the model. This value specifies the error variance,
which captures the unexplained variability within the model that is not
accounted for by the fixed or random effects. It is an important
parameter for determining the power.</p>
</div>
</div>
<div id="customized-design" class="section level3">
<h3>Customized design</h3>
<ul>
<li><code>designCustom(design.df, formula, beta, VarCov, sigma2, design.name, ...)</code></li>
</ul>
<p>If a design is not predefined in the package, it can be constructed
using the <code>designCustom</code> function. The required inputs are
<code>design.df</code>, <code>formula</code>, <code>beta</code>,
<code>VarCov</code>, <code>sigma2</code>, and optionally,
<code>design.name</code>. All arguments have been defined above, except
for <code>design.df</code>, which refers to a data frame containing the
columns of independent variables, outlining the structure of the data to
be collected in the experiment. Note that this data frame does not
include a response variable. The <code>design.name</code> argument
allows for specifying a custom name for the design, if desired.</p>
</div>
</div>
<div id="step2-calculating-power-or-sample-size" class="section level2">
<h2>Step2: Calculating Power or Sample Size</h2>
<p>Once the design object is created, calculating power or sample size
is straightforward. Power for omnibus tests, including main effects and
their interactions (if specified in the model during the creation of the
design object), can be calculated using:</p>
<ul>
<li><code>pwr.anova(design, alpha = 0.05, ...)</code></li>
</ul>
<p>The required inputs include:</p>
<ol style="list-style-type: decimal">
<li><code>design</code>, the object created in <a href="#id_#%20Step1:%20Creating%20a%20Design%20Object">Step 1</a>;</li>
<li><code>alpha</code>, indicating the Type I error rate, with a default
value of 0.05.</li>
</ol>
<p>For specific contrasts, power can be calculated using:</p>
<ul>
<li><code>pwr.contrast(design, alpha = 0.05, spec, method, ...)</code></li>
</ul>
<p>The syntax of the <strong>emmeans</strong> package is inherited to
specify contrasts of interest. The required inputs are:</p>
<ol style="list-style-type: decimal">
<li><code>design</code>;</li>
<li><code>alpha</code>;</li>
<li><code>spec</code>, an argument inherited from
<strong>emmeans</strong>, which specifies the names of the factors over
which the contrasts are performed.</li>
<li><code>method</code>, another argument inherited from
<strong>emmeans</strong>, which specifies the method of contrasts (e.g.,
“pairwise”, “trt.vs.ctrl”, “poly”).</li>
</ol>
<p>The minimal sample size needed to achieve a target power can be
determined using:</p>
<ul>
<li><code>find_sample_size(design.quote, alpha = 0.05, target.power = 0.8, n_init = 2, n_max = 99)</code></li>
</ul>
<p>This function calculates the minimum sample size necessary by
incrementally checking integers from <code>n_init</code> to
<code>n_max</code>. The required inputs are:</p>
<ol style="list-style-type: decimal">
<li><code>design.quote</code>: A quoted design object with an unknown
and unevaluated replication argument, to be evaluated with varying
values;</li>
<li><code>alpha</code>;</li>
<li><code>target.power</code>: A single value specifying the target
power for all effects, or a vector specifying individual target power
levels for each effect, with a default value of 0.05;</li>
<li><code>n_init</code>: The initial number of replications for the
iterative process, with a default value of 2;</li>
<li><code>n_max</code>: The maximum number of replications for the
iterative process, with a default value of 99.</li>
</ol>
<p>Currently, sample size determination is available only for omnibus
tests and not for specific contrasts in <strong>pwr4exp</strong>.</p>
</div>
</div>
<div id="practical-examples" class="section level1">
<h1>Practical Examples</h1>
<div id="example-1.-completely-randomized-design" class="section level2">
<h2>Example 1. Completely Randomized Design</h2>
<p>In this example, we will create a CRD with one treatment factor. The
design parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li>Treatments: 1 treatment factor with 4 levels;</li>
<li>Replicates: 8 experimental units per treatment.</li>
<li>Mean and effect size: The mean of control is 35, and the effects of
other three treatments are -5, +2, and +3.</li>
<li>Error variance: The variance of response variable is 15.</li>
</ol>
<p><strong>Create the CRD</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>crd <span class="ot">&lt;-</span> <span class="fu">designCRD</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="dv">4</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">8</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="sc">-</span><span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">15</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Power for the omnibus test</strong></p>
<p>The power of the omnibus test (i.e., F-test) can be calculated using
the <code>pwr.anova</code> function. Under the type I error rate of
0.05, the power for testing an overall difference among treatments is
0.95467.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(<span class="at">design =</span> crd)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; Power analysis of Completely Randomized Design</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;     NumDF DenDF non-centrality alpha   power</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; trt     3    28         20.267  0.05 0.95467</span></span></code></pre></div>
<p><strong>Power for specific contrasts</strong></p>
<p>To assess the power for specific contrasts, use the
<code>pwr.contrast</code> function. For example, to calculate the power
for detecting differences between treatments and the control:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> crd, <span class="at">specs =</span>  <span class="sc">~</span> trt, <span class="at">method =</span> <span class="st">&quot;trt.vs.ctrl&quot;</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt;      contrast estimate df non-centrality alpha     power</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; 1 trt2 - trt1       -5 28       6.666667  0.05 0.7028739</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; 2 trt3 - trt1        2 28       1.066667  0.05 0.1694975</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; 3 trt4 - trt1        3 28       2.400000  0.05 0.3216803</span></span></code></pre></div>
<p>To calculate the power for detecting linear or polynomial trends
across the treatment levels:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> crd, <span class="at">specs =</span>  <span class="sc">~</span> trt, <span class="at">method =</span> <span class="st">&quot;poly&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt;    contrast estimate df non-centrality alpha     power</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; 1    linear       16 28       6.826667  0.05 0.7130735</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt; 2 quadratic        6 28       4.800000  0.05 0.5617849</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt; 3     cubic      -18 28       8.640000  0.05 0.8098383</span></span></code></pre></div>
</div>
<div id="example-2.-randomized-complete-block-design" class="section level2">
<h2>Example 2. Randomized Complete Block Design</h2>
<p>In this example, we will create an RCBD with two treatment factors.
The design parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li>Treatments: A 2x2 factorial design.</li>
<li>Replicates: 8 blocks.</li>
<li>Mean and effect size: The mean of the control (A1B1) is 35. The
effect of A2 alone is an increase of 5 units, and the effect of B2 alone
is an increase of 3 units. The interaction between A2 and B2 introduces
an additional effect of -2 units, meaning the combined effect of A2 and
B2 is 2 units below the sum of their individual effects. The
corresponding cell means are:<span class="math display">\[
\begin{array}{c|c|c}
  &amp; B1 &amp; B2 \\
\hline
A1 &amp; 35 &amp; 38 \\
A2 &amp; 40  &amp; 41 \\
\end{array}
\]</span></li>
<li>Variance among blocks: 11.</li>
<li>Error variance: 4. The total variance of the response variable (15)
is decomposed into variance between blocks (11) and variance within
blocks (4).</li>
</ol>
<p><strong>Create the RCBD</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>rcbd <span class="ot">&lt;-</span> <span class="fu">designRCBD</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">blocks =</span> <span class="dv">8</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="at">VarCov =</span> <span class="dv">11</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">4</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Power for the omnibus test</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(<span class="at">design =</span> rcbd)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; Power Analysis of Randomized Complete Block Design</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt;           NumDF DenDF non-centrality alpha   power</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt; facA          1    21             32  0.05 0.99969</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; facB          1    21              8  0.05 0.76950</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; facA:facB     1    21              2  0.05 0.27138</span></span></code></pre></div>
<p><strong>Power for specific contrasts</strong></p>
<p>The power for detecting the effect of facA, both overall and within
each level of facB, can be assessed as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># across all levels of facB</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> rcbd, <span class="at">specs =</span> <span class="sc">~</span> <span class="st">&quot;facA&quot;</span>, <span class="at">method =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Results may be misleading due to involvement in interactions</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;        contrast estimate df non-centrality alpha    power</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; 1 facA1 - facA2       -4 21             32  0.05 0.999691</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># at each level of facB</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> rcbd, <span class="at">specs =</span> <span class="sc">~</span> facA<span class="sc">|</span>facB, <span class="at">method =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;        contrast facB estimate df non-centrality alpha     power</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; 1 facA1 - facA2    1       -5 21             25  0.05 0.9974502</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; 2 facA1 - facA2    2       -3 21              9  0.05 0.8160596</span></span></code></pre></div>
<p><strong>Sample Size Determination</strong></p>
<p>To determine the number of blocks required to achieve the target
power, the <code>find_sample_size</code> function can be used. First, we
create a quoted design object where <code>blocks = n</code> remains
unevaluated:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>rcbd_quote <span class="ot">&lt;-</span> <span class="fu">quote</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">designRCBD</span>(</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">blocks =</span> n,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">VarCov =</span> <span class="dv">11</span>,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">4</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  )</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>)</span></code></pre></div>
<p>The optimal sample size for the target power within the range of
n_init and n_max can be determined as follows:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">find_sample_size</span>(<span class="at">design.quote =</span> rcbd_quote, <span class="at">n_init =</span> <span class="dv">2</span>, <span class="at">n_max =</span> <span class="dv">99</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt;           alpha     power best_n</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; facA       0.05 0.8212779      3</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; facB       0.05 0.8207219      9</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; facA:facB  0.05 0.8115100     33</span></span></code></pre></div>
</div>
<div id="example-3.-latin-square-design" class="section level2">
<h2>Example 3. Latin Square Design</h2>
<p>In this example, we extend the design from Example 2 by introducing
another blocking factor, thus creating an LSD. The treatment structure
and effect sizes remain the same as in Example 2. The design controls
for two sources of variability (row and column blocks) while evaluating
the treatment effects. In the LSD, the total variance (15) is further
decomposed into three components:</p>
<ul>
<li>Variance between row blocks (11),</li>
<li>Variance between column blocks (2), and</li>
<li>Residual error variance (2).</li>
</ul>
<p>In this example, we will customize the labels for the two factors as
follows: “temp” with levels “T1” and “T2”, and “dosage” with levels “D1”
and “D2”.</p>
<p><strong>Create the LSD</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>lsd <span class="ot">&lt;-</span> <span class="fu">designLSD</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">list</span>(<span class="at">temp =</span> <span class="fu">c</span>(<span class="st">&quot;T1&quot;</span>, <span class="st">&quot;T2&quot;</span>), <span class="at">dosage =</span> <span class="fu">c</span>(<span class="st">&quot;D1&quot;</span>, <span class="st">&quot;D2&quot;</span>)),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="at">squares =</span> <span class="dv">4</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="at">reuse =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  <span class="at">VarCov =</span> <span class="fu">list</span>(<span class="dv">11</span>, <span class="dv">2</span>),</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">2</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Power for the omnibus test</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(<span class="at">design =</span> lsd)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; Power Analysis of Latin Square Design</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt;             NumDF DenDF non-centrality alpha   power</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; temp            1    33            128  0.05 1.00000</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; dosage          1    33             32  0.05 0.99979</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; temp:dosage     1    33              8  0.05 0.78387</span></span></code></pre></div>
<p><strong>Power for specific contrasts</strong></p>
<p>The power for detecting the effect of <em>dosage</em>, both overall
and within each level of <em>temp</em>, can be assessed as follows:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># the effect of dosage across all levels of temp</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> lsd, <span class="at">specs =</span> <span class="sc">~</span> <span class="st">&quot;dosage&quot;</span>, <span class="at">method =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Results may be misleading due to involvement in interactions</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;   contrast estimate df non-centrality alpha     power</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt; 1  D1 - D2       -2 33             32  0.05 0.9997892</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># the effect of dosage at each level of temp</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> lsd, <span class="at">specs =</span> <span class="sc">~</span> dosage<span class="sc">|</span>temp, <span class="at">method =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt;   contrast temp estimate df non-centrality alpha     power</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; 1  D1 - D2   T1       -3 33             36  0.05 0.9999429</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; 2  D1 - D2   T2       -1 33              4  0.05 0.4927485</span></span></code></pre></div>
<p><strong>Sample Size Determination</strong></p>
<p>To determine the number of squares required to achieve the target
power, the <code>find_sample_size</code> function can be used. First, we
create a quoted design object where <code>squares = n</code> remains
unevaluated:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>lsd_quote <span class="ot">&lt;-</span> <span class="fu">quote</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="fu">designLSD</span>(</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="at">squares =</span> n,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="at">reuse =</span> <span class="st">&quot;both&quot;</span>,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  <span class="at">VarCov =</span> <span class="fu">list</span>(<span class="dv">11</span>, <span class="dv">2</span>),</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">2</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  )</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>)</span></code></pre></div>
<p>The optimal sample size for the target power within the range of
n_init and n_max can be determined as follows:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">find_sample_size</span>(<span class="at">design.quote =</span> lsd_quote, <span class="at">n_init =</span> <span class="dv">2</span>, <span class="at">n_max =</span> <span class="dv">99</span>)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt;           alpha     power best_n</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt; facA       0.05 1.0000000      2</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; facB       0.05 0.9618851      2</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; facA:facB  0.05 0.8705999      5</span></span></code></pre></div>
</div>
<div id="example-4-split-plot-design" class="section level2">
<h2>Example 4: Split-plot Design</h2>
<p>In this example, we will create a SPD with two treatment factors, one
at each level. The design parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li><p>Treatments: One main plot factor having 2 levels, and another
factor with 3 levels at the sub-plot level.</p></li>
<li><p>Label: The two treatment factors are labeled as “Main” with
levels “Main1” and “Main2,” and “Sub” with levels “Sub1” and “Sub2,”
corresponding to the main plot and subplot, respectively.</p></li>
<li><p><strong>Replicates</strong>: There are 10 main plots, with 5 main
plots per “Main” treatment level, resulting in 10 experimental units
(blocks) for each “Sub” treatment level.</p></li>
<li><p>The mean of the control (Main1 with Sub1) is 20. The effect of
Main2 alone is an increase of 2 units. The effects of Sub2 and Sub3
alone are increases of 2 and 4 units, respectively. The interaction
between Main2 and Sub2 is zero. The interaction between Main2 and Sub3
introduces an additional effect of 2 units, meaning the combined effect
of Main2 and Sub3 is 2 units above the sum of their individual effects.
The corresponding cell means are:<span class="math display">\[
\begin{array}{c|c|c}
  &amp; Sub1 &amp; Sub2 &amp; Sub3 \\
\hline
Main1 &amp; 20 &amp; 22 &amp; 24\\
Main2 &amp; 22 &amp; 24 &amp; 28 \\
\end{array}
\]</span></p></li>
<li><p>The total variance (15) is assumed to decompose into 4 for
whole-plot error and 11 for subplot error.</p></li>
</ol>
<p><strong>Create the SPD</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>spd <span class="ot">&lt;-</span> <span class="fu">designSPD</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">trt.main =</span> <span class="dv">2</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="at">trt.sub =</span> <span class="dv">3</span>, </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">10</span>, </span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">list</span>(<span class="at">Main =</span> <span class="fu">c</span>(<span class="st">&quot;Main1&quot;</span>, <span class="st">&quot;Main2&quot;</span>), <span class="at">Sub =</span> <span class="fu">c</span>(<span class="st">&quot;Sub1&quot;</span>, <span class="st">&quot;Sub2&quot;</span>, <span class="st">&quot;Sub3&quot;</span>)),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>  <span class="at">beta =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  <span class="at">VarCov =</span> <span class="fu">list</span>(<span class="dv">4</span>),</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">11</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Power for the omnibus test</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(spd)</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; Power Analysis of Split Plot Design</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt;          NumDF DenDF non-centrality alpha   power</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; Main         1    18         4.6377  0.05 0.53114</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; Sub          2    36        23.0303  0.05 0.98924</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; Main:Sub     2    36         1.2121  0.05 0.14311</span></span></code></pre></div>
<p><strong>Power for specific contrasts</strong></p>
<p>The power for detecting the effect of subplot treatment under each
level of main plot treatment, can be assessed as follows:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(<span class="at">design =</span> spd, <span class="at">specs =</span> <span class="sc">~</span> Sub<span class="sc">|</span>Main, <span class="at">method =</span> <span class="st">&quot;trt.vs.ctrl&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt;      contrast  Main estimate df non-centrality alpha     power</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; 1 Sub2 - Sub1 Main1        2 36       1.818182  0.05 0.2592167</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; 2 Sub3 - Sub1 Main1        4 36       7.272727  0.05 0.7467531</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; 3 Sub2 - Sub1 Main2        2 36       1.818182  0.05 0.2592167</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; 4 Sub3 - Sub1 Main2        6 36      16.363636  0.05 0.9758744</span></span></code></pre></div>
</div>
<div id="example-5-a-customized-design" class="section level2">
<h2>Example 5: A customized design</h2>
<p>In this example, we will create a COD arranged at the “subplot” level
of a split-plot layout.</p>
<p>Sixteen subjects, split evenly between two breeds (8 subjects per
breed), are enrolled in a 4x4 crossover design. Within each breed, the
subjects are further divided into two squares (for a total of four
squares), with each square consisting of four subjects. Each subject
follows one of four treatment sequences and receives treatments across
four periods. This hybrid SPD-COD combines elements of a SPD and a COD
to evaluate treatment effects across different breeds. The Latin Square
structure ensures that within each square, treatments are balanced
across periods, while the split-plot element accounts for breed as a
whole-plot factor. The overall structure is as follows:</p>
<ul>
<li><p><strong>Treatment structure</strong></p>
<ul>
<li><strong>Whole-plot level</strong>: Breed (2 breeds, with 8 subjects
in each breed)</li>
<li><strong>Sub-plot level</strong>: A 2x2 factorial design with two
treatment factors, facA and facB.</li>
</ul></li>
<li><p><strong>Experimental units</strong></p>
<ul>
<li>Whole-plot factor: Subjects (randomly selected from two breeds)</li>
<li>Sub-plot factor: Measurements taken from subjects at each
period.</li>
</ul></li>
<li><p><strong>Variance decomposition</strong> The overall variance (15)
is decomposed into three main components: subject variance (7), period
variance (4), and random error (4).</p></li>
</ul>
<p><strong>Construct the design data frame</strong></p>
<p>To create the design object for this hybrid SPD-COD, we first need to
construct a data frame containing all the independent variables,
structured to resemble the actual experimental data. This data frame can
be generated using the internal function <code>df.cod</code>, which
builds a data frame for a COD with the specified treatment structure and
number of replications. Once the base data frame is generated, a column
for the “Breed” variable is manually added. It is important to note that
no randomization occurs at this stage—the data frame simply represents
the data structure and is not the actual randomized experimental data.
Its purpose is to create the design layout.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>df_spd_cod <span class="ot">&lt;-</span> pwr4exp<span class="sc">:::</span><span class="fu">df.cod</span>(</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="at">squares =</span> <span class="dv">4</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="do">## Create main plot factor, i.e., breed</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>df_spd_cod<span class="sc">$</span>Breed <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>), <span class="at">each =</span> <span class="dv">32</span>)</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="do">## Check data structure</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="fu">head</span>(df_spd_cod, <span class="at">n =</span> <span class="dv">4</span>); <span class="fu">tail</span>(df_spd_cod, <span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt;   subject period trt facA facB square Breed</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt; 1       1      1   2    2    1      1     1</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt; 2       2      1   3    1    2      1     1</span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt; 3       3      1   4    2    2      1     1</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt; 4       4      1   1    1    1      1     1</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co">#&gt;    subject period trt facA facB square Breed</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt; 61      13      4   1    1    1      4     2</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt; 62      14      4   2    2    1      4     2</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt; 63      15      4   3    1    2      4     2</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt; 64      16      4   4    2    2      4     2</span></span></code></pre></div>
<p><strong>Specify the model formula</strong></p>
<p>Next, an appropriate model formula must be specified to fit the
experimental design. The formula captures the interactions between
breed, the two treatment factors (facA and facB), and the random effects
for subjects and periods.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>formula <span class="ot">&lt;-</span> y <span class="sc">~</span> Breed<span class="sc">*</span>facA<span class="sc">*</span>facB <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>subject) <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>period)</span></code></pre></div>
<p><strong>Fixed effects</strong></p>
<p>We then specify the fixed effects for the model, where beta contains
the baseline intercept and the effects of each factor and their
interactions.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">35</span>,        <span class="co"># Baseline (mean of Breed1_A1_B1)</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="at">Breed2 =</span> <span class="sc">-</span><span class="dv">5</span>,           <span class="co"># Effect of the second breed alone</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  <span class="at">facA2 =</span> <span class="sc">-</span><span class="dv">5</span>,               <span class="co"># Effect of A2 alone</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>  <span class="at">facB2 =</span> <span class="dv">1</span>,                <span class="co"># Effect of B2 alone</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  <span class="st">`</span><span class="at">Breed2:facA2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>,         <span class="co"># Interaction between Breed2 and A2</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>  <span class="st">`</span><span class="at">Breed2:facB2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>,         <span class="co"># Interaction between Breed2 and B2</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>  <span class="st">`</span><span class="at">facA2:facB2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>,             <span class="co"># Interaction between A2 and B2</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a>  <span class="st">`</span><span class="at">Breed2:facA2:facB2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>       <span class="co"># Three-way interaction between Breed2, A2, and B2</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Create the design object</strong></p>
<p>After constructing the data frame, model formula, and fixed effects,
the design object can be created using the <code>designCustom</code>
function. The variance-covariance structure and error variance are also
provided to complete the design.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>SPD_COD <span class="ot">&lt;-</span> <span class="fu">designCustom</span>(</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  <span class="at">design.df =</span> df_spd_cod,</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="at">formula =</span> formula,</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a>  <span class="at">beta =</span> beta,</span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>  <span class="at">VarCov =</span> <span class="fu">list</span>(<span class="dv">7</span>, <span class="dv">4</span>),</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">4</span>,</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>  <span class="at">design.name =</span> <span class="st">&quot;hybrid SPD COD&quot;</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Power for the omnibus test</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(SPD_COD)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co">#&gt; Power Analysis of hybrid SPD COD</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt;                 NumDF DenDF non-centrality alpha   power</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt; Breed               1    14          9.031  0.05 0.79790</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt; facA                1    39         42.250  0.05 0.99999</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt; facB                1    39         20.250  0.05 0.99238</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt; Breed:facA          1    39          2.250  0.05 0.30997</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt; Breed:facB          1    39          0.250  0.05 0.07768</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt; facA:facB           1    39          6.250  0.05 0.68372</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt; Breed:facA:facB     1    39          0.250  0.05 0.07768</span></span></code></pre></div>
<p><strong>Power for specific contrasts</strong></p>
<p>We can also calculate the power for specific contrasts. For example,
to assess the power for detecting differences between facA1 and facA2 at
each level of facB within each breed:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(SPD_COD, <span class="sc">~</span>facA<span class="sc">|</span>facB<span class="sc">|</span>Breed, <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt;        contrast facB Breed estimate df non-centrality alpha     power</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt; 1 facA1 - facA2    1     1        5 39             25  0.05 0.9982139</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co">#&gt; 2 facA1 - facA2    2     1        3 39              9  0.05 0.8328312</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">#&gt; 3 facA1 - facA2    1     2        4 39             16  0.05 0.9737940</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co">#&gt; 4 facA1 - facA2    2     2        1 39              1  0.05 0.1641134</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Hrong-Tai Fai, A., &amp; Cornelius, P. L. (1996). Approximate F-tests
of multiple degree of freedom hypotheses in generalized least squares
analyses of unbalanced split-plot experiments. Journal of statistical
computation and simulation, 54(4), 363-378.</p>
<p>Kenward, M. G., &amp; Roger, J. H. (1997). Small sample inference for
fixed effects from restricted maximum likelihood. Biometrics,
983-997.</p>
</div>
<div id="acknowledgments" class="section level1">
<h1>Acknowledgments</h1>
<p>The development of <strong>pwr4exp</strong> has benefited greatly
from several R packages. Specifically, it leverages and modifies
critical functionality from <strong>lmerTest</strong>,
<strong>car</strong>, and <strong>emmeans</strong> to determine degrees
of freedom (<span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span>) and the non-centrality parameter
(<span class="math inline">\(\phi\)</span>), making power analysis more
accessible and efficient. We are particularly grateful to the authors
and contributors of these packages, as well as the broader R community
for their valuable tools and resources.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
