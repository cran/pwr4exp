<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="R Package Version 1.0.1" />

<meta name="date" content="2025-11-11" />

<title>pwr4exp: Power Analysis for Experimental Designs</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">pwr4exp: Power Analysis for Experimental
Designs</h1>
<h4 class="author">R Package Version 1.0.1</h4>
<h4 class="date">2025-11-11</h4>


<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#design" id="toc-design">Creating a design object</a>
<ul>
<li><a href="#mkdesign" id="toc-mkdesign">The <code>mkdesign</code>
function</a></li>
<li><a href="#standard_design" id="toc-standard_design">Specific design
functions</a></li>
<li><a href="#template" id="toc-template">Parameter templates</a></li>
<li><a href="#correlation-structures" id="toc-correlation-structures">Correlation structures</a></li>
</ul></li>
<li><a href="#power" id="toc-power">Power calculation</a>
<ul>
<li><a href="#power-calculation-for-omnibus-f-tests" id="toc-power-calculation-for-omnibus-f-tests">Power Calculation for
Omnibus F-Tests</a></li>
<li><a href="#power-calculation-for-specific-contrasts" id="toc-power-calculation-for-specific-contrasts">Power Calculation for
Specific Contrasts</a></li>
<li><a href="#power-calculation-for-model-coefficients" id="toc-power-calculation-for-model-coefficients">Power Calculation for
Model Coefficients</a></li>
</ul></li>
<li><a href="#practical-examples" id="toc-practical-examples">Practical
Examples</a>
<ul>
<li><a href="#example-1.-completely-randomized-design" id="toc-example-1.-completely-randomized-design">Example 1. Completely
Randomized Design</a></li>
<li><a href="#example-2.-randomized-complete-block-design" id="toc-example-2.-randomized-complete-block-design">Example 2.
Randomized complete block design</a></li>
<li><a href="#example-3.-latin-square-design" id="toc-example-3.-latin-square-design">Example 3. Latin square
design</a></li>
<li><a href="#example-4-split-plot-design" id="toc-example-4-split-plot-design">Example 4: Split-plot
Design</a></li>
<li><a href="#example-5-repeated-measures" id="toc-example-5-repeated-measures">Example 5: Repeated
measures</a></li>
</ul></li>
<li><a href="#fundamental-concepts" id="toc-fundamental-concepts">Fundamental concepts</a>
<ul>
<li><a href="#inference-on-treatment-effects" id="toc-inference-on-treatment-effects">Inference on Treatment
Effects</a></li>
<li><a href="#power-calculation-under-the-alternative-hypothesis" id="toc-power-calculation-under-the-alternative-hypothesis">Power
Calculation Under the Alternative Hypothesis</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p><strong>pwr4exp</strong> is an R package for performing statistical
power analysis for experiments analyzed using linear mixed models (LMM).
It supports power calculations for omnibus F-tests (ANOVA-like tests)
and specific contrasts (t-tests) for Gaussian response variables,
employing the Satterthwaite approximation for degrees of freedom.</p>
<p><strong>Key features:</strong></p>
<ul>
<li><strong>Consistency:</strong> Specify the model formula to ensure
consistency between power analysis and data analysis.</li>
<li><strong>Flexibility:</strong> Support a variety of experimental
designs through either the general-purpose function
(<code>mkdesign</code>) or specialized functions (e.g.,
<code>designCRD</code>, <code>designRCBD</code>, <code>designLSD</code>,
<code>designCOD</code>, <code>designSPD</code>) for standard
designs.</li>
<li><strong>Correlation structures:</strong> Allow specification of
various residual variance-covariance structures, which is essential for
analyzing repeated measures, spatial, or other correlated data.</li>
</ul>
<p>The workflow involves two main steps:</p>
<ol style="list-style-type: decimal">
<li><p><a href="#design">Creating a design object</a>: Defining the
experimental structure and specifying parameters (fixed effects,
(co-)variances).</p></li>
<li><p><a href="#power">Calculating power</a>: Computing the power of
F-tests or t-tests for the effects of interest.</p></li>
</ol>
</div>
<div id="design" class="section level1">
<h1>Creating a design object</h1>
<p>A design object in <strong>pwr4exp</strong> is a <code>list</code>
containing design matrices, fixed effects, variance-covariance
components, and other higher-level parameters created by the
design-generating functions. It is not an experimental design in the
traditional sense, where randomization and unit allocation are
performed, but rather a container for all the information necessary to
conduct power analysis.</p>
<p>Two approaches are provided to define a design:</p>
<ul>
<li><a href="#mkdesign"><strong>General approach with
<code>mkdesign</code>:</strong></a> A design object can be created by
providing a model formula and a data frame that outlines the
experimental layout.</li>
<li><a href="#standard_design"><strong>Standard designs with Specific
Functions:</strong></a> Functions such as <code>designCRD</code>,
<code>designRCBD</code>, <code>designLSD</code>, <code>designCOD</code>,
or <code>designSPD</code> generate design objects for common
experimental setups. These functions allow specification of design
characteristics (e.g., number of treatments, blocks, or replicates) and
automatically handle the creation of the data frame.</li>
</ul>
<div id="mkdesign" class="section level2">
<h2>The <code>mkdesign</code> function</h2>
<p>The function <code>mkdesign</code> is versatile for designs as long
as the data frame is provided.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">mkdesign</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  formula, data,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">beta =</span> <span class="cn">NULL</span>, <span class="at">means =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">vcomp =</span> <span class="cn">NULL</span>, <span class="at">sigma2 =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">correlation =</span> <span class="cn">NULL</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">template =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">REML =</span> <span class="cn">TRUE</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><p><strong><code>formula</code>:</strong> A right-hand-side model
formula that defines fixed and random effects. (Use
<code>lme4::lmer</code> syntax for specifying random effects.)</p></li>
<li><p><strong><code>data</code>:</strong> A data frame containing all
independent variables required by the model, consistent with the
design’s structure.</p></li>
<li><p><strong><code>means</code></strong> or <strong>beta:</strong>
Expected fixed effects. Either a vector of model coefficients
(<code>beta</code>) or expected means (<code>means</code>) must be
provided. <a href="#fixeff_template">Templates</a> for parameter
ordering can be generated by setting
<code>template = TRUE</code>.</p></li>
<li><p><strong><code>vcomp</code>:</strong> Variance components for any
random effects present in the model, provided as a numeric vector. A <a href="#vcomp_template">template</a> for input ordering can be generated
by setting <code>template = TRUE</code>.</p></li>
<li><p><strong><code>sigma2</code>:</strong> The residual
variance.</p></li>
<li><p><strong><code>correlation</code>:</strong> (Optional) A
correlation structure (<code>nlme::corClasses</code>) for repeated
measures.</p></li>
<li><p><a href="#template"><strong><code>template</code>:</strong></a>
When set to <code>TRUE</code> or when only the <code>formula</code> and
<code>data</code> arguments are provided, templates for
<code>beta</code>, <code>means</code>, and <code>vcomp</code> are
generated to indicate the required input order.</p></li>
<li><p><strong><code>REML</code>:</strong> (logical) Whether to use the
REML or ML information matrix. The default is <code>TRUE</code>
(REML).</p></li>
</ul>
</div>
<div id="standard_design" class="section level2">
<h2>Specific design functions</h2>
<p>While <code>mkdesign</code> provides full flexibility,
<strong>pwr4exp</strong> also offers specific functions for common
experimental designs. These functions allow users to define a design
based on treatment structure and replications without manually creating
a data frame.</p>
<blockquote>
<p><strong>Completely randomized design (CRD)</strong></p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">designCRD</span>(treatments, label, replicates, formula, beta, means, sigma2, <span class="at">template =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<blockquote>
<p><strong>Randomized complete block design (RCBD)</strong></p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">designRCBD</span>(treatments, label, blocks, formula, beta, means, vcomp, sigma2, <span class="at">template =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<blockquote>
<p><strong>Latin square design (LSD)</strong></p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">designLSD</span>(treatments, label, squares, reuse, formula, beta, means, vcomp, sigma2, <span class="at">template =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<blockquote>
<p><strong>Crossover design</strong></p>
</blockquote>
<p>This is a special case of LSD where time periods and individuals act
as blocks. Period blocks are reused when replicating squares.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">designCOD</span>(treatments, label, squares, formula, beta, means, vcomp, sigma2, <span class="at">template =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<blockquote>
<p><strong>Split-plot design (SPD)</strong></p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">designSPD</span>(trt.main, trt.sub, label, replicates, formula, beta, means, vcomp, sigma2, <span class="at">template =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The inputs for these functions are similar to <code>mkdesign</code>,
except that <code>data</code> is replaced by predefined design
characteristics such as treatment levels and replications.</p>
<p><strong>Key inputs</strong></p>
<blockquote>
<ul>
<li><p><strong><code>treatments</code></strong>: A numeric vector
specifying the number of levels for treatment factors. Multiple factors
are arranged factorially. For example, <code>treatments = c(3, 2)</code>
specifies two treatment factors one with 3 levels and another with 2
levels, forming a factorial treatment design.</p></li>
<li><p><strong><code>trt.main</code></strong> and
<strong><code>trt.sub</code></strong>: Define main-plot and subplot
treatments for SPD, following the same rule for
<code>treatment</code>.</p></li>
<li><p><strong><code>label</code></strong>: (optional) A list assigning
labels to factor levels. If not specified, default names are assigned.
For one treatment factor, the default is
<code>list(trt = c(&quot;1&quot;, &quot;2&quot;, ...))</code>. For two factors, the default
is <code>list(facA = c(&quot;1&quot;, &quot;2&quot;, ...), facB = c(&quot;1&quot;, &quot;2&quot;, ...))</code>,
where “facA” and “facB” represent the two factors, and “1”, “2”, etc.,
represent the levels of each factor.</p></li>
<li><p><strong><code>replicates</code></strong>: Number of experimental
units per treatment in CRD or number of main plots (i.e., the number of
experimental units per main-plot treatment) in SPD.</p></li>
<li><p><strong><code>blocks</code></strong>: Number of blocks in
RCBD.</p></li>
<li><p><strong><code>squares</code></strong>: Number of squares in LSD
or COD.</p></li>
<li><p><strong><code>reuse</code></strong>: Specifies how squares are
replicated in LSD. One of:</p></li>
</ul>
<blockquote>
<ul>
<li><code>&quot;row&quot;</code>: reuse row blocks</li>
<li><code>&quot;col&quot;</code>: reuse column blocks</li>
<li><code>&quot;none&quot;</code>: reuse neither row nor column blocks</li>
</ul>
</blockquote>
<ul>
<li><a href="#template"><strong><code>template</code></strong></a>: When
set to <code>TRUE</code>, templates for <code>beta</code>,
<code>means</code>, and <code>vcomp</code> are generated to indicate the
required input order.</li>
</ul>
</blockquote>
<p>Each of these design-generating functions has a default
<code>formula</code> based on the treatment structure (e.g., one factor
or factorial factors). If <code>formula</code> is not specified, a
default formula with main effects and all interactions (if applicable)
is used internally. In RCBD, LSD, COD, and SPD designs, all block
factors are fitted as random effects. The <code>formula</code> component
in the output design object (a <code>list</code>) can be inspected.</p>
</div>
<div id="template" class="section level2">
<h2>Parameter templates</h2>
<p>Templates help ensure the correct ordering of fixed effects
(<code>beta</code> or <code>means</code>) and random effects
(<code>vcomp</code>).</p>
<p>Below, an exemplary data frame is created to illustrate these
templates. Note that this example <strong>does NOT</strong> represent a
realistic design. The data frame includes:</p>
<blockquote>
<ul>
<li>Four categorical variables (<code>fA</code>, <code>fB</code>,
<code>fC</code>, <code>fD</code>),</li>
<li>Two numerical variables (<code>x</code>, <code>z</code>).</li>
</ul>
</blockquote>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a> df1 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>   <span class="at">fA =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="co"># factor A with 2 levels</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>   <span class="at">fB =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="co"># factor B with 2 levels</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>   <span class="at">fC =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="co"># factor C with 3 levels</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>   <span class="at">fD =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="co"># factor D with 3 levels</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>   <span class="at">subject =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)  <span class="co"># 10 subjects</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a> )</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a> df1<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(df1))  <span class="co"># Numerical variable x</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a> df1<span class="sc">$</span>z <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(df1))  <span class="co"># Numerical variable z</span></span></code></pre></div>
<div id="fixeff_template" class="section level3">
<h3><code>beta</code> Template</h3>
<blockquote>
<p>The <code>beta</code> template displays the order of model
coefficients in the fitted model.</p>
</blockquote>
<p>This is particularly useful when specifying expected model
coefficients directly as effect size measures and when the model
includes complex interactions. For example, the expected values of the
model coefficients for <code>~ fA*fB + x</code> should be provided in
the following sequence:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">mkdesign</span>( <span class="sc">~</span> fA <span class="sc">*</span> fB <span class="sc">+</span> x, df1)<span class="sc">$</span>fixeff<span class="sc">$</span>beta</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; (Intercept)         fA2         fB2           x     fA2:fB2 </span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4           5</span></span></code></pre></div>
</div>
<div id="means-template" class="section level3">
<h3><code>means</code> Template</h3>
<p>For treatment factors, it may be more more convenient to provide
<code>means</code> instead of <code>beta</code>. The <code>means</code>
template represents either marginal or cell means for factors, depending
on the presence of interactions. For numerical variables included in the
model, regression coefficients remain necessary alongside alongside the
means for factors.</p>
<p><strong>Factors without interactions</strong></p>
<blockquote>
<p>If no interactions are present, <strong>marginal means</strong> for
each factor level are required.</p>
</blockquote>
<p>For example, for the model <code>~ fA + fB</code>, means should be
reported in the order specified by the template:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> fA <span class="sc">+</span> fB, df1, <span class="at">template =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>fixeff<span class="sc">$</span>means</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt; fA1 fA2 fB1 fB2 </span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt;   1   2   3   4</span></span></code></pre></div>
<p><strong>Interactions among factors</strong></p>
<blockquote>
<p>When factors interact, <strong>conditional (cell) means</strong> must
be provided for all possible combinations of their levels.</p>
</blockquote>
<p>For example, for a model with three interacting factors
(<code>fA</code>, <code>fB</code>, <code>fC</code>), cell means are
required for all 12 level combinations in the following order:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> fA <span class="sc">*</span> fB <span class="sc">*</span> fC, df1)<span class="sc">$</span>fixeff<span class="sc">$</span>means</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="co">#&gt; fA1:fB1:fC1 fA2:fB1:fC1 fA1:fB2:fC1 fA2:fB2:fC1 fA1:fB1:fC2 fA2:fB1:fC2 </span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4           5           6 </span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; fA1:fB2:fC2 fA2:fB2:fC2 fA1:fB1:fC3 fA2:fB1:fC3 fA1:fB2:fC3 fA2:fB2:fC3 </span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt;           7           8           9          10          11          12</span></span></code></pre></div>
<p><strong>Numerical variables</strong></p>
<blockquote>
<p>For numerical variables, regression coefficients are required. If the
model only includes numerical variables, the intercept must also be
included. In this case, the values in means are identical to beta:</p>
</blockquote>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> x <span class="sc">+</span> z, df1)<span class="sc">$</span>fixeff<span class="sc">$</span>means</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; (Intercept)           x           z </span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;           1           2           3</span></span></code></pre></div>
<blockquote>
<p>When numerical variables interact, regression coefficients for both
main effects and interaction terms must be included.</p>
</blockquote>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> x <span class="sc">*</span> z, df1)<span class="sc">$</span>fixeff<span class="sc">$</span>means</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; (Intercept)           x           z         x:z </span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4</span></span></code></pre></div>
<p><strong>Factor-by-numerical interactions</strong></p>
<blockquote>
<p>For interactions between factor and numerical variables, both
<strong>Marginal means</strong> for the factor, and <strong>Regression
coefficients</strong> for the numerical variable at each level of the
factor must be provided.</p>
</blockquote>
<p>For instance, in the model <code>~ fA * x</code>, the means for
levels of <code>fA</code> and the regression coefficients for
<code>x</code> at each level of <code>fA</code> must be provided:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> fA <span class="sc">*</span> x, df1)<span class="sc">$</span>fixeff<span class="sc">$</span>means</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt;   fA1   fA2 fA1:x fA2:x </span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt;     1     2     3     4</span></span></code></pre></div>
<p><strong>Combining Multiple Situations</strong></p>
<blockquote>
<p>The rules outlined for factor and numerical variables apply when
multiple types of variables and interactions appear in the same
model.</p>
</blockquote>
<p>For example, consider a model including interactions among three
factors (<code>fA</code>, <code>fB</code>, <code>fC</code>),
factor-by-numerical interaction (<code>fD * x</code>), and main effects
for another numerical variable (<code>z</code>).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> fA <span class="sc">*</span> fB <span class="sc">*</span> fC <span class="sc">+</span> fD <span class="sc">*</span> x <span class="sc">+</span> z, df1)<span class="sc">$</span>fixeff<span class="sc">$</span>means</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt;         fD1         fD2         fD3           z       fD1:x       fD2:x </span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4           5           6 </span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt;       fD3:x fA1:fB1:fC1 fA2:fB1:fC1 fA1:fB2:fC1 fA2:fB2:fC1 fA1:fB1:fC2 </span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;           7           8           9          10          11          12 </span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt; fA2:fB1:fC2 fA1:fB2:fC2 fA2:fB2:fC2 fA1:fB1:fC3 fA2:fB1:fC3 fA1:fB2:fC3 </span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt;          13          14          15          16          17          18 </span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt; fA2:fB2:fC3 </span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt;          19</span></span></code></pre></div>
<p>The required elements and their order in means are:</p>
<p>1. Means for each level of <code>fD</code> (positions 1–3)</p>
<p>2. Regression coefficient for <code>z</code> (position 4)</p>
<p>3. Regression coefficients for <code>x</code> at each level of
<code>fD</code> (positions 5–7)</p>
<p>4. Cell means for all combinations of levels of <code>fA</code>,
<code>fB</code>, and <code>fC</code> (positions 8–19)</p>
</div>
<div id="vcomp_template" class="section level3">
<h3><code>vcomp</code> Template</h3>
<blockquote>
<p>The <code>vcomp</code> template represents variance-covariance
matrices, where integer values indicate the order of variance components
in the input vector.</p>
</blockquote>
<p>For a single random effect, a template is unnecessary since it
corresponds to a single variance value. For multiple random effects, the
template specifies the sequence of variance and covariance components,
ensuring proper alignment when specifying variance components in the
model.</p>
<p>For example, consider a model that includes both a random intercept
and a random slope for <code>fA</code> by <code>subject</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="sc">~</span> fA <span class="sc">*</span> fB <span class="sc">*</span> fC <span class="sc">*</span> fD <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> fA <span class="sc">|</span> subject), df1)<span class="sc">$</span>varcov</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt; $subject</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt;             (Intercept) fA2</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; (Intercept)           1   2</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; fA2                   2   3</span></span></code></pre></div>
<p>The template specifies the following required inputs:</p>
<ol style="list-style-type: decimal">
<li><p>Variance of the random intercept</p></li>
<li><p>Covariance between the random intercept and slop</p></li>
<li><p>Variance of the random slop (<code>fA2</code>)</p></li>
</ol>
</div>
</div>
<div id="correlation-structures" class="section level2">
<h2>Correlation structures</h2>
<p>Although specifying complex variance-covariance structures, such as
unstructured <code>nlme::corSymm</code>, may seem impractical for power
analysis, various correlation structures from the <strong>nlme</strong>
package can be applies.</p>
<p>The available correlation structures, as outlined in <a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-167/topics/corClasses"><code>nlme::corClasses</code></a>,
including</p>
<ul>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corAR1"><code>corAR1</code></a>
– First-order autoregressive</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corARMA"><code>corARMA</code></a>
– Autoregressive moving average</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corCAR1"><code>corCAR1</code></a>
– Continuous-time autoregressive</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corCompSymm"><code>corCompSymm</code></a>
– Compound symmetry</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corExp"><code>corExp</code></a>
– Exponential spatial correlation</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corGaus"><code>corGaus</code></a>
– Gaussian spatial correlation</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corLin"><code>corLin</code></a>
– Linear spatial correlation</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corSymm"><code>corSymm</code></a>
– Unstructured correlation</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corRatio"><code>corRatio</code></a>
– Ratio-based spatial correlation</p></li>
<li><p><a href="https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/corSpher"><code>corSpher</code></a>
– Spherical spatial correlation</p></li>
</ul>
<p>Note: In <code>nlme::corAR1()</code> and <code>nlme::corARMA()</code>
when <code>p=1</code> and <code>q=0</code>, the time variable must be an
integer. However, in <code>pwr4exp</code>, this restriction has been
released, factors are also supported.</p>
</div>
</div>
<div id="power" class="section level1">
<h1>Power calculation</h1>
<p>Once a design object has been created, calculating statistical power
is straightforward.</p>
<div id="power-calculation-for-omnibus-f-tests" class="section level2">
<h2>Power Calculation for Omnibus F-Tests</h2>
<p>The statistical power for <strong>F-tests</strong> (ANOVA-like tests)
can be computed using the <code>pwr.anova</code> function.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(object, <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">type =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><p><strong><code>object</code></strong>: the design object created
in the previous step.</p></li>
<li><p><strong><code>sig.level</code></strong>: significance level,
default <code>0.05</code>.</p></li>
<li><p><strong><code>type</code></strong>: the type of ANOVA table
(default: <code>3</code>).</p></li>
</ul>
</div>
<div id="power-calculation-for-specific-contrasts" class="section level2">
<h2>Power Calculation for Specific Contrasts</h2>
<p>To evaluate statistical power for <strong>t-tests</strong> on
specific contrasts, use the <code>pwr.contrast</code> function.</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(object, which, <span class="at">by =</span> <span class="cn">NULL</span>, </span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">&quot;pairwise&quot;</span>, <span class="st">&quot;poly&quot;</span>, <span class="st">&quot;trt.vs.ctrl&quot;</span>),</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">p.adj =</span> <span class="cn">FALSE</span>, </span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">&quot;two.sided&quot;</span>, <span class="st">&quot;one.sided&quot;</span>), <span class="at">strict =</span> <span class="cn">TRUE</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><p><strong><code>object</code></strong>: The design object.</p></li>
<li><p><strong><code>which</code></strong>: The factor of interest.
Multiple factors can be combined using <code>:</code> or <code>*</code>
(e.g., <code>&quot;facA*facB&quot;</code> treats combined factor levels as a
single factor).</p></li>
<li><p><strong><code>by</code></strong>: The variable to condition
on.</p></li>
<li><p><strong><code>contrast</code></strong>: Contrast method, on
of</p>
<ul>
<li><p><code>&quot;pairwise&quot;</code> - pairwise comparisons</p></li>
<li><p><code>&quot;poly&quot;</code> - polynomial contrasts</p></li>
<li><p><code>&quot;trt.vs.ctrl&quot;</code> - treatment vs. control
comparison</p></li>
<li><p>Alternatively, a <strong>numeric vector</strong> for a single
custom contrast, or a <strong>named list</strong> of contrast vectors.
If a list is provided, each vector must match the number of factor
levels in each <code>by</code> group. In multi-factor scenarios, factor
levels are combined and treated as a single factor.</p></li>
</ul></li>
<li><p><strong><code>sig.level</code></strong>: significance level
(default: <code>0.05</code>).</p></li>
<li><p><strong><code>p.adj</code></strong>: whether the
<code>sig.level</code> should be adjusted using the Bonferroni method
(default: FALSE).</p></li>
<li><p><strong><code>alternative</code></strong>:
<code>&quot;two.sided&quot;</code> (default) or <code>&quot;one.sided&quot;</code>.</p></li>
<li><p><strong><code>strict</code></strong>: Controls how power is
calculated in two-sided tests (default: <code>TRUE</code>). If
<code>TRUE</code>, includes the probability of rejection in the opposite
direction of the true effect. If <code>FALSE</code>, power equals half
the significance level when the true difference is zero.</p></li>
</ul>
</div>
<div id="power-calculation-for-model-coefficients" class="section level2">
<h2>Power Calculation for Model Coefficients</h2>
<p>The <code>pwr.summary</code> function computes the statistical power
for testing model coefficients (t-tests).</p>
<p><strong>Usage</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">pwr.summary</span>(object, <span class="at">sig.level =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><strong>Arguments</strong></p>
<ul>
<li><strong><code>object</code></strong>: A design object</li>
<li><strong><code>sig.level</code></strong>: The significance level
(default: 0.05)</li>
</ul>
</div>
</div>
<div id="practical-examples" class="section level1">
<h1>Practical Examples</h1>
<div id="example-1.-completely-randomized-design" class="section level2">
<h2>Example 1. Completely Randomized Design</h2>
<p>In this example, we create a CRD with one treatment factor.</p>
<p><strong>Design parameters</strong></p>
<ol style="list-style-type: decimal">
<li><strong>Treatments</strong>: 1 treatment factor with 4 levels.</li>
<li><strong>Replicates</strong>: 8 experimental units per
treatment.</li>
<li><strong>Mean and effect size</strong>: Expected means for four
levels: 35, 30, 37, 38</li>
<li><strong>Error variance</strong>: 15</li>
</ol>
<p><strong>Step 1: Creating the CRD</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>crd <span class="ot">&lt;-</span> <span class="fu">designCRD</span>(</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="dv">4</span>,</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">8</span>,</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="at">means =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">30</span>, <span class="dv">37</span>, <span class="dv">38</span>),</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">15</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Step 2: Power for omnibus test</strong></p>
<p>To compute the power for the <strong>overall F-test
(ANOVA)</strong>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(crd)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; Power of type III F-test</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt;     NumDF DenDF sig.level   power</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; trt     3    28      0.05 0.95467</span></span></code></pre></div>
<p><strong>Step 3: Power for specific contrasts</strong></p>
<blockquote>
<p><strong>a) Pairwise Comparisons</strong></p>
</blockquote>
<p>To compute power for pairwise differences:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(crd, <span class="at">which =</span>  <span class="st">&quot;trt&quot;</span>, <span class="at">contrast =</span> <span class="st">&quot;pairwise&quot;</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co">#&gt;             effect df sig.level      power alternative</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; trt1 - trt2      5 28      0.05 0.70287390   two.sided</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt; trt1 - trt3     -2 28      0.05 0.16949749   two.sided</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt; trt1 - trt4     -3 28      0.05 0.32168033   two.sided</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; trt2 - trt3     -7 28      0.05 0.93677955   two.sided</span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co">#&gt; trt2 - trt4     -8 28      0.05 0.97860686   two.sided</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt; trt3 - trt4     -1 28      0.05 0.07896844   two.sided</span></span></code></pre></div>
<blockquote>
<p><strong>b) Polynomial Contrasts</strong></p>
</blockquote>
<p>To test for trends across treatment levels:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(crd, <span class="at">which =</span>  <span class="st">&quot;trt&quot;</span>, <span class="at">contrast =</span> <span class="st">&quot;poly&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co">#&gt;           effect df sig.level     power alternative</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; linear        16 28      0.05 0.7130735   two.sided</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">#&gt; quadratic      6 28      0.05 0.5617849   two.sided</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co">#&gt; cubic        -18 28      0.05 0.8098383   two.sided</span></span></code></pre></div>
<blockquote>
<p><strong>c) Treatment vs. Control Comparison</strong></p>
</blockquote>
<p>The power for detecting differences between treatments and the
control:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(crd, <span class="at">which =</span>  <span class="st">&quot;trt&quot;</span>, <span class="at">contrast =</span> <span class="st">&quot;trt.vs.ctrl&quot;</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co">#&gt;             effect df sig.level     power alternative</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; trt2 - trt1     -5 28      0.05 0.7028739   two.sided</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt; trt3 - trt1      2 28      0.05 0.1694975   two.sided</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt; trt4 - trt1      3 28      0.05 0.3216803   two.sided</span></span></code></pre></div>
<blockquote>
<p><strong>d) Custom Contrast: All Treatments vs. Control</strong></p>
</blockquote>
<p>In addition to pre-defined contrast method, custom contrast vectors
can be specified. For example, to compare the average of all treatments
against the control, use the contrast vector
<code>c(-1, 1/3, 1/3, 1/3)</code>. The power for this test can be
computed as:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(crd, <span class="at">which =</span>  <span class="st">&quot;trt&quot;</span>, <span class="at">contrast =</span> <span class="fu">list</span>(<span class="at">trts.vs.ctrl =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="co">#&gt;                    effect df sig.level power alternative</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="co">#&gt; trts.vs.ctrl 9.992007e-16 28      0.05  0.05   two.sided</span></span></code></pre></div>
<p><strong>Adjusting for Multiple Comparisons</strong></p>
<p>In real-world analysis, <strong>P-values</strong> often need
<strong>adjustment for multiple comparisons (MCP)</strong>. While most
<strong>post-hoc</strong> methods cannot be applied <strong>directly in
power analysis</strong>, we can <strong>lower the significance
level</strong> to approximate MCP adjustments.</p>
<blockquote>
<p><strong>Using a More Conservative Significance Level</strong></p>
</blockquote>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(crd, <span class="at">which =</span>  <span class="st">&quot;trt&quot;</span>, <span class="at">contrast =</span> <span class="st">&quot;pairwise&quot;</span>, <span class="at">sig.level =</span> <span class="fl">0.01</span>)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co">#&gt;             effect df sig.level     power alternative</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; trt1 - trt2      5 28      0.01 0.4418907   two.sided</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt; trt1 - trt3     -2 28      0.01 0.0546995   two.sided</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt; trt1 - trt4     -3 28      0.01 0.1320866   two.sided</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt; trt2 - trt3     -7 28      0.01 0.7946290   two.sided</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt; trt2 - trt4     -8 28      0.01 0.9042775   two.sided</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt; trt3 - trt4     -1 28      0.01 0.0194487   two.sided</span></span></code></pre></div>
<blockquote>
<p><strong>Using the Bonferroni Correction</strong></p>
<p>The <code>pwr.contrast</code> function includes an option for
<strong>Bonferroni correction</strong>, though it may be overly
conservative:</p>
</blockquote>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(crd, <span class="at">which =</span>  <span class="st">&quot;trt&quot;</span>, <span class="at">contrast =</span> <span class="st">&quot;pairwise&quot;</span>, <span class="at">sig.level =</span> <span class="fl">0.05</span>, <span class="at">p.adj =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt;             effect df   sig.level      power alternative</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt; trt1 - trt2      5 28 0.008333333 0.41456682   two.sided</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co">#&gt; trt1 - trt3     -2 28 0.008333333 0.04782486   two.sided</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">#&gt; trt1 - trt4     -3 28 0.008333333 0.11835238   two.sided</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co">#&gt; trt2 - trt3     -7 28 0.008333333 0.77333066   two.sided</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co">#&gt; trt2 - trt4     -8 28 0.008333333 0.89102508   two.sided</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co">#&gt; trt3 - trt4     -1 28 0.008333333 0.01655798   two.sided</span></span></code></pre></div>
</div>
<div id="example-2.-randomized-complete-block-design" class="section level2">
<h2>Example 2. Randomized complete block design</h2>
<p>In this example, we create a <strong>Randomized Complete Block Design
(RCBD)</strong> with <strong>two treatment factors</strong> in a
<strong>2×2 factorial design</strong>.</p>
<p><strong>Design Parameters</strong></p>
<ol style="list-style-type: decimal">
<li><strong>Treatments</strong>: A 2x2 factorial design (factors:
<code>A</code> and <code>B</code>).</li>
<li><strong>Replicates</strong>: 8 blocks.</li>
<li><strong>Expected Means</strong>: <span class="math display">\[
    \begin{array}{c|c|c}
&amp; B1 &amp; B2 \\
    \hline
    A1 &amp; 35 &amp; 38 \\
    A2 &amp; 40  &amp; 41 \\
    \end{array}
    \]</span> Corresponding <code>beta</code> values are as follows
(Optional):</li>
</ol>
<ul>
<li><em>Intercept (<code>A1B1</code>): 35</em></li>
<li><em>Effect of <code>A2</code> alone: 5 units</em></li>
<li><em>Effect of <code>B2</code> alone: 3 units</em></li>
<li><em>Interaction (<code>A2:B2</code>): -2 units (i.e., the combined
effect of <code>A2</code> and <code>B2</code> is 2 units below the
additive effects).</em></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><strong>Variance among blocks</strong>: 11.</li>
<li><strong>Error variance</strong>: 4.</li>
<li>The total variance of the response variable (15) is decomposed into
variance between blocks (11) and variance within blocks (4).</li>
</ol>
<p><strong>Step 1: Creating the RCBD</strong></p>
<ul>
<li><strong>Generate the templates</strong> to determine the correct
parameter order. Provide <code>beta</code> or <code>means</code>, and
<code>vcomp</code> according to the order below.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">designRCBD</span>(<span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">blocks =</span> <span class="dv">8</span>, <span class="at">template =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="co">#&gt; $fixeff</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="co">#&gt; $fixeff$beta</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co">#&gt; (Intercept)       facA2       facB2 facA2:facB2 </span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4 </span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#&gt; $fixeff$means</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co">#&gt; facA1:facB1 facA2:facB1 facA1:facB2 facA2:facB2 </span></span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4 </span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co">#&gt; $varcov</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co">#&gt; $varcov$block</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="co">#&gt;             (Intercept)</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">#&gt; (Intercept)           1</span></span></code></pre></div>
<ul>
<li><strong>Create the design object</strong></li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>rcbd <span class="ot">&lt;-</span> <span class="fu">designRCBD</span>(</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  <span class="at">blocks =</span> <span class="dv">8</span>,</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  <span class="co"># beta = c(35, 5, 3, -2), # identical to means</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>  <span class="at">means =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">38</span>, <span class="dv">41</span>),</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>  <span class="at">vcomp =</span> <span class="dv">11</span>,</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">4</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>)</span></code></pre></div>
<p>The default factor names and formula can be inspected in the design
object:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">unique</span>(rcbd<span class="sc">$</span>deStruct<span class="sc">$</span>fxTrms<span class="sc">$</span>fixedfr)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="co">#&gt;   facA facB</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="co">#&gt; 1    1    1</span></span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="co">#&gt; 2    2    1</span></span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="co">#&gt; 3    1    2</span></span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a><span class="co">#&gt; 4    2    2</span></span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>rcbd<span class="sc">$</span>deStruct<span class="sc">$</span>formula</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a><span class="co">#&gt; ~facA * facB + (1 | block)</span></span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a><span class="co">#&gt; &lt;environment: 0x7fef6902ea90&gt;</span></span></code></pre></div>
<p>Treatment factors and factor levels can be renamed and relabeled, and
the model formula can be changed. For example, if interactions are
removed, marginal means for both factors must be provided instead of
cell means.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">designRCBD</span>(<span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), </span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">list</span>(<span class="at">factorA =</span> <span class="fu">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="at">factorB =</span> <span class="fu">c</span>(<span class="st">&quot;B1&quot;</span>, <span class="st">&quot;B2&quot;</span>)), </span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>           <span class="at">blocks =</span> <span class="dv">8</span>, </span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>           <span class="at">formula =</span> <span class="sc">~</span> factorA <span class="sc">+</span> factorB <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>block), </span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>           <span class="at">template =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="co">#&gt; $fixeff</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="co">#&gt; $fixeff$beta</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="co">#&gt; (Intercept)   factorAA2   factorBB2 </span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="co">#&gt;           1           2           3 </span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="co">#&gt; $fixeff$means</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="co">#&gt; factorAA1 factorAA2 factorBB1 factorBB2 </span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="co">#&gt;         1         2         3         4 </span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="co">#&gt; $varcov</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="co">#&gt; $varcov$block</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="co">#&gt;             (Intercept)</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="co">#&gt; (Intercept)           1</span></span></code></pre></div>
<p><strong>Step 2: Evaluate statistical power</strong></p>
<p>To test overall effects of <code>facA</code> and
<code>facB</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(rcbd)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#&gt; Power of type III F-test</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="co">#&gt;           NumDF DenDF sig.level   power</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co">#&gt; facA          1    21      0.05 0.99969</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="co">#&gt; facB          1    21      0.05 0.76950</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="co">#&gt; facA:facB     1    21      0.05 0.27138</span></span></code></pre></div>
<p>To test differences between levels of <code>facA</code>, conditioned
on <code>facB</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(rcbd, <span class="at">which =</span> <span class="st">&quot;facA&quot;</span>, <span class="at">by =</span> <span class="st">&quot;facB&quot;</span>)</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co">#&gt; $`facB = 1`</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="co">#&gt;               effect df sig.level     power alternative</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co">#&gt; facA1 - facA2     -5 21      0.05 0.9974502   two.sided</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="co">#&gt; $`facB = 2`</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="co">#&gt;               effect df sig.level     power alternative</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="co">#&gt; facA1 - facA2     -3 21      0.05 0.8160596   two.sided</span></span></code></pre></div>
</div>
<div id="example-3.-latin-square-design" class="section level2">
<h2>Example 3. Latin square design</h2>
<p>In this example, we extend <em>Example 2</em> by introducing
<strong>another blocking factor</strong>, transforming the design into
an LSD.</p>
<ul>
<li><p>The <strong>treatment structure and effect sizes remain the
same</strong> as in <em>Example 2</em>.</p></li>
<li><p>The LSD controls for <strong>two sources of variability</strong>
(row and column blocks) while evaluating treatment effects.</p></li>
<li><p>The <strong>total variance (15)</strong> is further decomposed
into:</p>
<ul>
<li><p><strong>Variance between row blocks</strong>:
<code>11</code></p></li>
<li><p><strong>Variance between column blocks</strong>:
<code>2</code></p></li>
<li><p><strong>Residual error variance</strong>: <code>2</code></p></li>
</ul></li>
</ul>
<p><strong>Step 1: Creating the LSD</strong></p>
<p>Generate the templates to determine the correct order of inputs.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">designLSD</span>(</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>  <span class="at">squares =</span> <span class="dv">4</span>,</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>  <span class="at">reuse =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>  <span class="at">template =</span> <span class="cn">TRUE</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>)</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a><span class="co">#&gt; $fixeff</span></span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="co">#&gt; $fixeff$beta</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a><span class="co">#&gt; (Intercept)       facA2       facB2 facA2:facB2 </span></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4 </span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a><span class="co">#&gt; $fixeff$means</span></span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="co">#&gt; facA1:facB1 facA2:facB1 facA1:facB2 facA2:facB2 </span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a><span class="co">#&gt;           1           2           3           4 </span></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-16"><a href="#cb33-16" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-17"><a href="#cb33-17" tabindex="-1"></a><span class="co">#&gt; $varcov</span></span>
<span id="cb33-18"><a href="#cb33-18" tabindex="-1"></a><span class="co">#&gt; $varcov$row</span></span>
<span id="cb33-19"><a href="#cb33-19" tabindex="-1"></a><span class="co">#&gt;             (Intercept)</span></span>
<span id="cb33-20"><a href="#cb33-20" tabindex="-1"></a><span class="co">#&gt; (Intercept)           1</span></span>
<span id="cb33-21"><a href="#cb33-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-22"><a href="#cb33-22" tabindex="-1"></a><span class="co">#&gt; $varcov$col</span></span>
<span id="cb33-23"><a href="#cb33-23" tabindex="-1"></a><span class="co">#&gt;             (Intercept)</span></span>
<span id="cb33-24"><a href="#cb33-24" tabindex="-1"></a><span class="co">#&gt; (Intercept)           2</span></span></code></pre></div>
<p>Either <code>beta</code> or <code>means</code> can be provided, as in
<em>Example 2</em>. Note that although the variance component template
sets the order for <code>row</code> and <code>col</code> variances in
<code>vcomp</code>, these values don’t impact power as long as
<code>sigma2</code> is fixed because treatment effects are tested
against residual error. However, in designs where the error terms for
treatment factors include variance components beyond residual error
(like the next example), variance components can affect power for main
plot factors. It’s also recommended to use variance components as a
guide to make an informed estimate of <code>sigma2</code>.</p>
<p><strong>Create the LSD</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>lsd <span class="ot">&lt;-</span> <span class="fu">designLSD</span>(</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>  <span class="at">treatments =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">list</span>(<span class="at">temp =</span> <span class="fu">c</span>(<span class="st">&quot;T1&quot;</span>, <span class="st">&quot;T2&quot;</span>), <span class="at">dosage =</span> <span class="fu">c</span>(<span class="st">&quot;D1&quot;</span>, <span class="st">&quot;D2&quot;</span>)),</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="at">squares =</span> <span class="dv">4</span>,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>  <span class="at">reuse =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>  <span class="at">means =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">38</span>, <span class="dv">41</span>),</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>  <span class="at">vcomp =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">2</span>),</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">2</span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>)</span></code></pre></div>
<p>Once the design has been created, <code>pwr.anova</code> and
<code>pwr.contrast</code> can be used to evaluate statistical power as
demonstrated above.</p>
</div>
<div id="example-4-split-plot-design" class="section level2">
<h2>Example 4: Split-plot Design</h2>
<p>In this example, we create an SPD with two treatment factors, one at
the main plot level and another at the subplot level. The design
parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Treatments:</strong></p>
<ul>
<li><p><strong>Main plot factor</strong> with <strong>2
levels</strong></p></li>
<li><p><strong>Subplot factor</strong> with <strong>3
levels</strong></p></li>
</ul></li>
<li><p><strong>Replicates</strong>:</p>
<ul>
<li><p>Each main plot treatment has <strong>5 plots</strong>, for a
total of <strong>10 plots</strong>.</p></li>
<li><p>This is a standard SPD, where the plots are the blocks at the
subplot level and the subplot design follows an RCBD structure.</p></li>
</ul></li>
<li><p><strong>Expected cell means</strong> are: <span class="math display">\[
    \begin{array}{c|c|c}
      &amp; trt.sub1 &amp; trt.sub2 &amp; trt.sub3 \\
    \hline
    trt.main1 &amp; 20 &amp; 22 &amp; 24\\
    trt.main2 &amp; 22 &amp; 24 &amp; 28 \\
    \end{array}
    \]</span></p></li>
<li><p><strong>Variance Components</strong>:</p>
<ul>
<li><p><strong>Main-plot error</strong>: <code>4</code></p></li>
<li><p><strong>Subplot (residual) error</strong>:
<code>11</code></p></li>
<li><p><strong>Total variance</strong>: <code>15</code></p></li>
</ul></li>
</ol>
<p><strong>Generate input templates</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">designSPD</span>(</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>  <span class="at">trt.main =</span> <span class="dv">2</span>,</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  <span class="at">trt.sub =</span> <span class="dv">3</span>, </span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">10</span>, </span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  <span class="at">template =</span> <span class="cn">TRUE</span></span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>)</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a><span class="co">#&gt; $fixeff</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a><span class="co">#&gt; $fixeff$beta</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a><span class="co">#&gt;        (Intercept)          trt.main2           trt.sub2           trt.sub3 </span></span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a><span class="co">#&gt;                  1                  2                  3                  4 </span></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a><span class="co">#&gt; trt.main2:trt.sub2 trt.main2:trt.sub3 </span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a><span class="co">#&gt;                  5                  6 </span></span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a><span class="co">#&gt; $fixeff$means</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a><span class="co">#&gt; trt.main1:trt.sub1 trt.main2:trt.sub1 trt.main1:trt.sub2 trt.main2:trt.sub2 </span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a><span class="co">#&gt;                  1                  2                  3                  4 </span></span>
<span id="cb35-17"><a href="#cb35-17" tabindex="-1"></a><span class="co">#&gt; trt.main1:trt.sub3 trt.main2:trt.sub3 </span></span>
<span id="cb35-18"><a href="#cb35-18" tabindex="-1"></a><span class="co">#&gt;                  5                  6 </span></span>
<span id="cb35-19"><a href="#cb35-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-20"><a href="#cb35-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-21"><a href="#cb35-21" tabindex="-1"></a><span class="co">#&gt; $varcov</span></span>
<span id="cb35-22"><a href="#cb35-22" tabindex="-1"></a><span class="co">#&gt; $varcov$mainplot</span></span>
<span id="cb35-23"><a href="#cb35-23" tabindex="-1"></a><span class="co">#&gt;             (Intercept)</span></span>
<span id="cb35-24"><a href="#cb35-24" tabindex="-1"></a><span class="co">#&gt; (Intercept)           1</span></span></code></pre></div>
<p><strong>Create the SPD</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>spd <span class="ot">&lt;-</span> <span class="fu">designSPD</span>(</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="at">trt.main =</span> <span class="dv">2</span>,</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="at">trt.sub =</span> <span class="dv">3</span>, </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  <span class="at">replicates =</span> <span class="dv">10</span>, </span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>  <span class="at">means =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">22</span>, <span class="dv">22</span>, <span class="dv">24</span>, <span class="dv">24</span>, <span class="dv">28</span>),</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>  <span class="at">vcomp =</span> <span class="dv">4</span>,</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  <span class="at">sigma2 =</span> <span class="dv">11</span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>)</span></code></pre></div>
<p>One can verify that different values of <strong>main-plot error
(<code>vcomp</code>)</strong> affect the power of the <strong>main plot
factor</strong>, unlike in <em>Example 3</em>, where variance components
did not influence power.</p>
</div>
<div id="example-5-repeated-measures" class="section level2">
<h2>Example 5: Repeated measures</h2>
<p>This example illustrates a <strong>repeated measures design,</strong>
where <strong>three treatments</strong> (<code>CON</code>,
<code>TRT1</code>, <code>TRT2</code>) are measured <strong>hourly over 8
hours</strong>. <strong>Within-subject correlations</strong> are modeled
using an <strong>AR(1) structure</strong> with <span class="math inline">\(\rho = 0.6\)</span> and <span class="math inline">\(\sigma^2 = 2\)</span>.</p>
<p><strong>Design Details</strong></p>
<p>1. <strong>Subjects</strong>: 6 per treatment group (total: 18
subjects).<br />
2. <strong>Treatments</strong>: <code>CON</code>, <code>TRT1</code>, and
<code>TRT2</code>.<br />
3. <strong>Time Points</strong>: 8 hourly measurements.</p>
<p>4. <strong>Means</strong>:<span class="math display">\[
\begin{array}{c|cccccccc}
\textbf{Treatment} &amp; \textbf{1} &amp; \textbf{2} &amp; \textbf{3}
&amp; \textbf{4} &amp; \textbf{5} &amp; \textbf{6} &amp; \textbf{7}
&amp; \textbf{8} \\
\hline
\text{CON} &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp;
1.00 &amp; 1.00 &amp; 1.00 \\
\text{TRT1} &amp; 2.50 &amp; 3.50 &amp; 3.98 &amp; 4.03 &amp; 3.68 &amp;
3.35 &amp; 3.02 &amp; 2.94 \\
\text{TRT2} &amp; 3.50 &amp; 4.54 &amp; 5.80 &amp; 5.84 &amp; 5.49 &amp;
4.71 &amp; 4.08 &amp; 3.78 \\
\end{array}
\]</span></p>
<p><strong>Step 1: Creating the design</strong></p>
<p><strong>Create a data frame for the design</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>n_subject <span class="ot">=</span> <span class="dv">6</span> <span class="co"># Subjects per treatment</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>n_trt <span class="ot">=</span> <span class="dv">3</span> <span class="co"># Number of treatments</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>n_hour <span class="ot">=</span> <span class="dv">8</span> <span class="co"># Number of repeated measures (time points)</span></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a>trt <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;CON&quot;</span>, <span class="st">&quot;TRT1&quot;</span>, <span class="st">&quot;TRT2&quot;</span>)</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" tabindex="-1"></a>df.rep <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb37-7"><a href="#cb37-7" tabindex="-1"></a>  <span class="at">subject =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">seq_len</span>(n_trt<span class="sc">*</span>n_subject), <span class="at">each =</span> n_hour)),</span>
<span id="cb37-8"><a href="#cb37-8" tabindex="-1"></a>  <span class="at">hour =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">seq_len</span>(n_hour), n_subject<span class="sc">*</span>n_trt)),</span>
<span id="cb37-9"><a href="#cb37-9" tabindex="-1"></a>  <span class="at">trt =</span> <span class="fu">rep</span>(trt, <span class="at">each =</span> n_subject<span class="sc">*</span>n_hour)</span>
<span id="cb37-10"><a href="#cb37-10" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Input templates</strong></p>
<p>Either values of <code>beta</code> or <code>means</code> are required
in the following order:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="fu">mkdesign</span>(<span class="at">formula =</span> <span class="sc">~</span> trt<span class="sc">*</span>hour, <span class="at">data =</span> df.rep)</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a><span class="co">#&gt; $fixeff</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a><span class="co">#&gt; $fixeff$beta</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a><span class="co">#&gt;   (Intercept)       trtTRT1       trtTRT2         hour2         hour3 </span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="co">#&gt;             1             2             3             4             5 </span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a><span class="co">#&gt;         hour4         hour5         hour6         hour7         hour8 </span></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a><span class="co">#&gt;             6             7             8             9            10 </span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="co">#&gt; trtTRT1:hour2 trtTRT2:hour2 trtTRT1:hour3 trtTRT2:hour3 trtTRT1:hour4 </span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a><span class="co">#&gt;            11            12            13            14            15 </span></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a><span class="co">#&gt; trtTRT2:hour4 trtTRT1:hour5 trtTRT2:hour5 trtTRT1:hour6 trtTRT2:hour6 </span></span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a><span class="co">#&gt;            16            17            18            19            20 </span></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a><span class="co">#&gt; trtTRT1:hour7 trtTRT2:hour7 trtTRT1:hour8 trtTRT2:hour8 </span></span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a><span class="co">#&gt;            21            22            23            24 </span></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="co">#&gt; $fixeff$means</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a><span class="co">#&gt;  trtCON:hour1 trtTRT1:hour1 trtTRT2:hour1  trtCON:hour2 trtTRT1:hour2 </span></span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a><span class="co">#&gt;             1             2             3             4             5 </span></span>
<span id="cb38-18"><a href="#cb38-18" tabindex="-1"></a><span class="co">#&gt; trtTRT2:hour2  trtCON:hour3 trtTRT1:hour3 trtTRT2:hour3  trtCON:hour4 </span></span>
<span id="cb38-19"><a href="#cb38-19" tabindex="-1"></a><span class="co">#&gt;             6             7             8             9            10 </span></span>
<span id="cb38-20"><a href="#cb38-20" tabindex="-1"></a><span class="co">#&gt; trtTRT1:hour4 trtTRT2:hour4  trtCON:hour5 trtTRT1:hour5 trtTRT2:hour5 </span></span>
<span id="cb38-21"><a href="#cb38-21" tabindex="-1"></a><span class="co">#&gt;            11            12            13            14            15 </span></span>
<span id="cb38-22"><a href="#cb38-22" tabindex="-1"></a><span class="co">#&gt;  trtCON:hour6 trtTRT1:hour6 trtTRT2:hour6  trtCON:hour7 trtTRT1:hour7 </span></span>
<span id="cb38-23"><a href="#cb38-23" tabindex="-1"></a><span class="co">#&gt;            16            17            18            19            20 </span></span>
<span id="cb38-24"><a href="#cb38-24" tabindex="-1"></a><span class="co">#&gt; trtTRT2:hour7  trtCON:hour8 trtTRT1:hour8 trtTRT2:hour8 </span></span>
<span id="cb38-25"><a href="#cb38-25" tabindex="-1"></a><span class="co">#&gt;            21            22            23            24 </span></span>
<span id="cb38-26"><a href="#cb38-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-27"><a href="#cb38-27" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb38-28"><a href="#cb38-28" tabindex="-1"></a><span class="co">#&gt; $varcov</span></span>
<span id="cb38-29"><a href="#cb38-29" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p><strong>Create the design</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>design.rep <span class="ot">&lt;-</span> <span class="fu">mkdesign</span>(</span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="at">formula =</span> <span class="sc">~</span> trt<span class="sc">*</span>hour,</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a><span class="at">data =</span> df.rep,</span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a><span class="at">means =</span>  <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">2.50</span>, <span class="fl">3.5</span>,</span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">3.50</span>, <span class="fl">4.54</span>,</span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">3.98</span>, <span class="fl">5.80</span>,</span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">4.03</span>, <span class="fl">5.4</span>,</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">3.68</span>, <span class="fl">5.49</span>,</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">3.35</span>, <span class="fl">4.71</span>,</span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">3.02</span>, <span class="fl">4.08</span>,</span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>           <span class="dv">1</span>, <span class="fl">2.94</span>, <span class="fl">3.78</span>),</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a><span class="at">sigma2 =</span> <span class="dv">2</span>,</span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a><span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">value =</span> <span class="fl">0.6</span>, <span class="at">form =</span> <span class="sc">~</span> hour<span class="sc">|</span>subject)</span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>)</span></code></pre></div>
<p><strong>Step 2: Power calculation</strong></p>
<p>Statistical power for main effects of treatment and time, and their
interaction:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">pwr.anova</span>(design.rep)</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="co">#&gt; Power of type III F-test</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="co">#&gt;          NumDF  DenDF sig.level   power</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="co">#&gt; trt          2 21.563      0.05 1.00000</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="co">#&gt; hour         7 86.055      0.05 0.74687</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="co">#&gt; trt:hour    14 86.055      0.05 0.38500</span></span></code></pre></div>
<p>Statistical power for treatment differences at each time point:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">pwr.contrast</span>(design.rep, <span class="at">which =</span> <span class="st">&quot;trt&quot;</span>, <span class="at">by =</span> <span class="st">&quot;hour&quot;</span>, <span class="at">contrast =</span> <span class="st">&quot;trt.vs.ctrl&quot;</span>, <span class="at">p.adj =</span> <span class="cn">TRUE</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="co">#&gt; $`hour = 1`</span></span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a><span class="co">#&gt; trtTRT1 - trtCON    1.5 64.41176     0.025 0.3299823   two.sided</span></span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a><span class="co">#&gt; trtTRT2 - trtCON    2.5 64.41176     0.025 0.7765112   two.sided</span></span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a><span class="co">#&gt; $`hour = 2`</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a><span class="co">#&gt; trtTRT1 - trtCON   2.50 64.41176     0.025 0.7765112   two.sided</span></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a><span class="co">#&gt; trtTRT2 - trtCON   3.54 64.41176     0.025 0.9777118   two.sided</span></span></code></pre></div>
<p>As shown in <em>Example 5</em>, any design can be created using the
<code>mkdesign</code> function as long as the appropriate data frame is
provided. However, the package currently does not support non-normal
response variables.</p>
</div>
</div>
<div id="fundamental-concepts" class="section level1">
<h1>Fundamental concepts</h1>
<p><code>pwr4exp</code> is developed based on LMM theory. The general
form of an LMM can be expressed as:</p>
<p><span class="math display">\[
y = X\beta + Zu + \varepsilon
\]</span></p>
<p>where: <span class="math inline">\(y\)</span> represents the
observations of the response variable, <span class="math inline">\(\beta\)</span> represents the fixed effect
coefficients, <span class="math inline">\(u\)</span> denotes the random
effects, where <span class="math inline">\(u \sim N_q(0, G)\)</span>,
<span class="math inline">\(\varepsilon\)</span> represents the random
errors, where <span class="math inline">\(\varepsilon \sim N_n(0,
R)\)</span>, <span class="math inline">\(X_{(n \times p)}\)</span> and
<span class="math inline">\(Z_{(n \times q)}\)</span> are the design
matrices for the fixed and random effects, respectively.</p>
<p>It is assumed that <span class="math inline">\(u\)</span> and <span class="math inline">\(\varepsilon\)</span> are independent, and the
marginal distribution of <span class="math inline">\(y\)</span> follows
a normal distribution <span class="math inline">\(y \sim N_n(X\beta,
V)\)</span>, where:</p>
<p><span class="math display">\[
V = ZGZ^T + R
\]</span></p>
<div id="inference-on-treatment-effects" class="section level2">
<h2>Inference on Treatment Effects</h2>
<p>Inference on treatment effects often involves testing omnibus
hypotheses and contrasts. These can be formulated using the general
linear hypothesis:</p>
<p><span class="math display">\[
H_0: K\beta = 0
\]</span></p>
<p>where <span class="math inline">\(K\)</span> is a contrast matrix.
When the variance-covariance parameters in <span class="math inline">\(G\)</span> and <span class="math inline">\(R\)</span> are known, the estimate of <span class="math inline">\(\beta\)</span> is:</p>
<p><span class="math display">\[
\hat{\beta} = (X^TV^{-1}X)^{-1}X^TV^{-1}y
\]</span></p>
<p>And its variance is:</p>
<p><span class="math display">\[
C = (X^TV^{-1}X)^{-1}
\]</span></p>
<p>The sampling distribution of <span class="math inline">\(K&#39;\hat{\beta}\)</span> is:</p>
<p><span class="math display">\[
K&#39;\hat{\beta} \sim N(0, K&#39;CK)
\]</span></p>
<p>However, in practical situations, the matrices <span class="math inline">\(G\)</span> and <span class="math inline">\(R\)</span> are unknown and must be estimated using
methods like Maximum Likelihood (ML) or Restricted ML (REML). The
estimate of <span class="math inline">\(\beta\)</span> is obtained by
plugging in the estimated covariance matrices <span class="math inline">\(\hat{V}\)</span>, where:</p>
<p><span class="math display">\[
\hat{V} = Z\hat{G}Z^T + \hat{R}
\]</span></p>
<p>The resulting estimate of <span class="math inline">\(\beta\)</span>
is:</p>
<p><span class="math display">\[
\hat{\beta} = (X^T\hat{V}^{-1}X)^{-1}X^T\hat{V}^{-1}y
\]</span></p>
<p>And its estimated variance is:</p>
<p><span class="math display">\[
\hat{C} = (X^T\hat{V}^{-1}X)^{-1}
\]</span></p>
<p>When testing the null hypothesis <span class="math inline">\(H_0:
K\beta = 0\)</span>, an approximate F-statistic is used. The F-statistic
is given by:</p>
<p><span class="math display">\[
F = \frac{(K\hat{\beta})^T [K\hat{C}K^T]^{-1} (K\hat{\beta})}{v_1}
\]</span></p>
<p><span class="math inline">\(F\)</span> follows an approximate
F-distribution <span class="math inline">\(F(v_1, v_2)\)</span> under
<span class="math inline">\(H_0\)</span>, where <span class="math inline">\(v_1 = \text{rank}(K) \geq 1\)</span> represents
the numerator degrees of freedom (df), <span class="math inline">\(v_2\)</span> is the denominator df.</p>
<p>When <span class="math inline">\(\text{rank}(K) = 1\)</span>, the
F-statistic simplifies to the square of the t-statistic:</p>
<p><span class="math display">\[
F = t^2
\]</span>where <span class="math inline">\(t =
\frac{k&#39;\hat{\beta}}{\sqrt{k&#39;\hat{C}K}}\)</span> with <span class="math inline">\(v_2\)</span> df.</p>
<p>In balanced designs, where data is analyzed using a variance
components model, commonly applied in experimental animal research,
<span class="math inline">\(v_2\)</span>​ can be precisely determined
through degrees of freedom decomposition, as applied in analysis of
variance (ANOVA).</p>
<p>However, for more general cases, <span class="math inline">\(v_2\)</span> must be approximated using
methods.</p>
<p>The Satterthwaite approximation (Satterthwaite, 1946) for DF in
t-tests can be calculated as outlined by Giesbrecht and Burns
(1985):</p>
<p><span class="math display">\[
v_2 = \frac{2(k^T \hat{C} k)^2}{g^T A g}
\]</span></p>
<p>where: <span class="math inline">\(g\)</span> is the gradient of
<span class="math inline">\(k^T C(\hat{\theta}) k\)</span> with respect
to <span class="math inline">\(\theta\)</span>, the variance-covariance
parameters in <span class="math inline">\(V\)</span>, evaluated at <span class="math inline">\(\hat{\theta}\)</span>. Matrix <span class="math inline">\(A\)</span> is the asymptotic variance-covariance
matrix of <span class="math inline">\(\hat{\theta}\)</span>, obtained
from the information matrix of ML or REML estimation of <span class="math inline">\(\hat{\theta}\)</span> (Stroup, 2012).</p>
<p>In F-tests, <span class="math inline">\(v_2\)</span> can be
calculated by following the procedures described by Fai and Cornelius
(1996). First, <span class="math inline">\(KC\hat{K}^T\)</span> is
decomposed to yield <span class="math inline">\(KC\hat{K}^T = P^T D
P\)</span>, where <span class="math inline">\(P\)</span> is an
orthogonal matrix of eigen vectors, and <span class="math inline">\(D\)</span> is a diagonal matrix of eigenvalues.
Define <span class="math inline">\(k_m Ck_m^T\)</span>, where <span class="math inline">\(k_m\)</span> is the <span class="math inline">\(m\)</span>-th row of <span class="math inline">\(P
K\)</span>, and let:</p>
<p><span class="math display">\[
v_m = \frac{2(D_m)^2}{g_m^T A g_m}
\]</span></p>
<p>where: <span class="math inline">\(D_m\)</span>is the <span class="math inline">\(m\)</span>th diagonal element of <span class="math inline">\(D\)</span>, <span class="math inline">\(g_m\)</span> is the gradient of <span class="math inline">\(k_m C k_m^T\)</span> with respect to <span class="math inline">\(\theta\)</span>, evaluated at <span class="math inline">\(\hat{\theta}\)</span>.</p>
<p>Then let:</p>
<p><span class="math display">\[
E = \sum_{m=1}^{v_1} \frac{v_m}{v_m - 2} I(v_m &gt; 2)
\]</span></p>
<p>where <span class="math inline">\(I(v_m &gt; 2)\)</span> denotes the
indicator function. The denominator DF <span class="math inline">\(v_2\)</span> is calculated as:</p>
<p><span class="math display">\[
v_2 = \frac{2E}{E - v_1}
\]</span> The Satterthwaite approximation can be applied in power
analysis by plugging in the assumed values of variance parameters
(Stroup, 2002).</p>
</div>
<div id="power-calculation-under-the-alternative-hypothesis" class="section level2">
<h2>Power Calculation Under the Alternative Hypothesis</h2>
<p>Under the alternative hypothesis <span class="math inline">\(H_A:
K&#39;\beta \neq 0\)</span>, the F-statistic follows a non-central
distribution <span class="math inline">\(F(v_1, v_2, \phi)\)</span>,
where <span class="math inline">\(\phi\)</span> is the non-centrality
parameter that measures the departure from the null hypothesis <span class="math inline">\(H_0\)</span>. The non-centrality parameter <span class="math inline">\(\phi\)</span> is given by:</p>
<p><span class="math display">\[
\phi = (K\hat{\beta})^T [K\hat{C}K^T]^{-1} (K\hat{\beta})
\]</span></p>
<p>Once the distribution of the F-statistic under <span class="math inline">\(H_A\)</span> is known, the power of the test can
be calculated as the conditional probability of rejecting <span class="math inline">\(H_0\)</span> when <span class="math inline">\(H_A\)</span> is true:</p>
<p><span class="math display">\[
\text{Power} = P(\text{reject } H_0: F &gt; F_{\text{crit}} \mid H_A)
\]</span></p>
<p>Where: <span class="math inline">\(F_{\text{crit}}\)</span> is the
critical value of the F-statistic used to reject <span class="math inline">\(H_0\)</span>, determined such that <span class="math inline">\(P(F &gt; F_{\text{crit}} \mid H_0) =
\alpha\)</span>, where <span class="math inline">\(\alpha\)</span> is
the type I error rate.</p>
<p>The determination of the degrees of freedom <span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span>, as well as the non-centrality
parameter <span class="math inline">\(\phi\)</span>, are critical steps
for power calculation.</p>
<p>Generally, power analysis requires specifying the following
components:</p>
<ul>
<li>The <strong>Design</strong> to be evaluated, which determines the
matrices <span class="math inline">\(X\)</span> (fixed effects) and
<span class="math inline">\(Z\)</span> (random effects).</li>
<li>The <strong>Treatment Effects</strong>, which determine <span class="math inline">\(\beta\)</span> (the fixed effect
coefficients).</li>
<li>The <strong>Variance Components</strong>, which determine <span class="math inline">\(G\)</span> (the covariance matrix of the random
effects) and <span class="math inline">\(R\)</span> (the covariance
matrix of the residuals).</li>
</ul>
<p>A key aspect of conducting a valid power analysis is obtaining
<strong>reasonable estimates for the magnitude of the
parameters</strong> that will be used in the model. This includes:</p>
<ul>
<li><strong>Treatment Effects</strong> (<span class="math inline">\(\beta\)</span>): The size of the treatment
effect(s) you expect to detect. This can be obtained from previous
studies, pilot experiments, or subject-matter expertise.</li>
<li><strong>Variance Components</strong> (<span class="math inline">\(G\)</span> and <span class="math inline">\(R\)</span>): These represent the variability in
the random effects and residual errors. Variance estimates are often
obtained from:
<ul>
<li><strong>Pilot studies</strong> or preliminary data, which can
provide initial estimates of variability in random effects (e.g.,
subject-to-subject variability or group-level variability).</li>
<li><strong>Literature</strong> on similar experiments, where variance
components have been reported.</li>
<li><strong>Subject-matter expertise</strong>, where researchers provide
estimates based on their knowledge of the system being studied.</li>
</ul></li>
</ul>
<p>Performing a power analysis with unrealistic parameter magnitudes can
lead to incorrect conclusions, either overestimating the likelihood of
detecting a treatment effect or requiring an unnecessarily large sample
size.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<p>Fai, A. H., &amp; Cornelius, P. L. (1996). Approximate F-tests of
multiple degree of freedom hypotheses in generalized least squares
analyses of unbalanced split-plot experiments. <em>Journal of
Statistical Computation and Simulation, 54</em>(4), 363–378.</p>
<p>Giesbrecht, F. G., &amp; Burns, J. C. (1985). Two-stage analysis
based on a mixed model: Large-sample asymptotic theory and small-sample
simulation results. <em>Biometrics, 41</em>(2), 477–486.</p>
<p>Satterthwaite, F. E. (1946). An approximate distribution of estimates
of variance components. <em>Biometrics Bulletin, 2</em>(6), 110–114.</p>
<p>Stroup, W. W. (2002). Power analysis based on spatial effects mixed
models: A tool for comparing design and analysis strategies in the
presence of spatial variability. <em>Journal of Agricultural,
Biological, and Environmental Statistics, 7</em>(4), 491–511.</p>
<p>Stroup, W. W. (2012). <em>Generalized linear mixed models: Modern
concepts, methods, and applications</em> (1st ed.). CRC Press.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
